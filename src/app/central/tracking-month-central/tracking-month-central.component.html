<app-navbar
  [email]="this.auth.currentUser.email"
  [firstName]="this.auth.currentUser.firstName"
  [path]="'home'"
></app-navbar>

<!-- investements -->

<div class="container mx-auto px-4 mt-4 mb-2">
  <div
    class="relative mx-auto max-w-3xl rounded-2xl border border-slate-200 bg-white/70 backdrop-blur-md p-4 md:p-5 shadow-sm"
  >
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4">
      <div class="flex items-center gap-3 min-w-0">
        <div
          class="grid h-10 w-10 place-items-center rounded-xl bg-gradient-to-br from-emerald-400 to-teal-500 text-white text-xl"
        >
          ðŸ“ˆ
        </div>
        <h1
          class="min-w-0 bg-gradient-to-r text-center from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent font-extrabold tracking-tight leading-tight text-2xl md:text-4xl break-words whitespace-normal"
        >
          ActivitÃ©s Central Du Mois
        </h1>
      </div>

      <span
        class="sm:ml-auto inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-sm md:text-lg selection:font-medium text-slate-700 shadow order-last sm:order-none"
      >
        <time>{{ time.monthFrenchNames[givenMonth - 1] }} {{ givenYear }}</time>
      </span>
    </div>

    <div
      class="absolute -bottom-[2px] left-6 right-6 h-[3px] rounded-full bg-gradient-to-r from-emerald-400 via-teal-500 to-cyan-400"
    ></div>
  </div>
</div>
<div class="flex container mx-auto justify-center text-center space-x-8">
  <div class="mb-6">
    <!-- <label for="payments" class="block mb-2 text-md font-medium text-gray-900 m-2">Mois: {{givenMonth}}</label> -->
    <select
      id="payments"
      [(ngModel)]="givenMonth"
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
      (change)="initalizeInputs()"
    >
      <option *ngFor="let month of monthsList" [ngValue]="month">
        {{ time.monthFrenchNames[month - 1] }}
      </option>

      <!-- <option [ngValue]="maxRange">Max</option> -->
    </select>
  </div>

  <div class="mb-6">
    <!-- <label for="payments" class="block mb-2 text-md font-medium text-gray-900 m-2">AnnÃ©e: {{givenYear}}</label> -->
    <select
      id="payments"
      [(ngModel)]="givenYear"
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
      (change)="initalizeInputs()"
    >
      <option *ngFor="let year of this.time.yearsList" [ngValue]="year">
        {{ year }}
      </option>

      <!-- <option [ngValue]="maxRange">Max</option> -->
    </select>
  </div>
</div>

<div
  class="container flex flex-wrap flex-col items-center justify-center mx-auto md:flex-row"
>
  <div class="flex-col w-60 m-6" *ngFor="let s of summary; let i = index">
    <a
      class="block max-w-sm p-6 bg-neutral-200 border border-gray-200 rounded-lg shadow hover:bg-green-100"
    >
      <img
        src="{{ imagePaths[i] }}"
        alt=""
        class="w-20 justify-center mx-auto"
      />

      <h5
        class="my-2 text-2xl text-center font-bold tracking-tight text-gray-900"
      >
        {{ s }}
      </h5>
      <h2 class="font-bold text-lg text-green-700 text-center">
        FC {{ summaryContent[i] | number : "1.0-0" }}
      </h2>
      <h2 class="font-bold text-lg text-yellow-900 text-center">
        $ {{ valuesConvertedToDollars[i] | number : "1.0-0" }}
      </h2>
    </a>
  </div>
</div>

<div class="container mx-auto px-4 py-6">
  <!-- one-per-row, no forced side-by-side -->
  <div class="grid grid-cols-1 2xl:grid-cols-2 gap-8">
    <!-- ====== RÃ‰SERVE DU MOIS ====== -->
    <div
      class="rounded-2xl 2xl:max-w-3xl border border-slate-200 bg-white/70 p-5 shadow-sm backdrop-blur-md dark:border-slate-700 dark:bg-slate-900/60"
    >
      <div class="mb-4">
        <h2 class="text-xl font-semibold tracking-tight dark:text-slate-100">
          Classement Du Mois
          <span
            class="ml-1 bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent"
          >
            ({{ time.monthFrenchNames[givenMonth - 1] }} {{ givenYear }})
          </span>
        </h2>

        <div
          class="mt-3 flex flex-wrap items-center gap-3 text-sm text-slate-600 dark:text-slate-300"
        >
          <div
            class="rounded-full bg-emerald-100 px-2.5 py-1 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-200"
          >
            Total:
            {{ toNum(givenMonthTotalReserveAmount) | number : "1.0-0" }} FC Â·
            {{ toNum(givenMonthTotalReserveAmountDollars) | number : "1.0-0" }}
            $
          </div>
          <div
            class="rounded-full bg-slate-100 px-2.5 py-1 text-slate-700 dark:bg-slate-800 dark:text-slate-200"
          >
            Croissance: {{ toNum(growthRateTotal) | number : "1.0-0" }} %
          </div>
          <div
            class="rounded-full bg-cyan-50 px-2.5 py-1 text-cyan-700 ring-1 ring-cyan-200 dark:bg-cyan-900/30 dark:text-cyan-200 dark:ring-cyan-800"
          >
            Barre = % du meilleur $
          </div>
        </div>
      </div>

      <!-- no overflow container: show full table -->
      <div class="rounded-xl ring-1 ring-slate-200 dark:ring-slate-700">
        <table class="w-full table-auto text-sm font-normal tabular-nums">
          <thead
            class="bg-slate-50 text-xs uppercase tracking-wide text-slate-600 dark:bg-slate-800 dark:text-slate-300"
          >
            <tr>
              <th class="px-4 py-3 text-left">Rang</th>
              <th class="px-2 py-3 text-left">Ã‰quipe</th>
              <th class="px-4 py-3 text-right">RÃ©serve (FC)</th>
              <th class="px-4 py-3 text-right">RÃ©serve ($)</th>
              <th class="px-4 py-3 text-right">Î” Croissance</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
            <tr
              *ngFor="let s of sortedReserveMonth; let i = index"
              class="odd:bg-white/90 even:bg-white/60 hover:bg-emerald-50/60 dark:odd:bg-slate-900/40 dark:even:bg-slate-900/30 dark:hover:bg-slate-800/60"
            >
              <td class="px-4 py-3">
                <span
                  class="inline-flex h-8 w-8 items-center justify-center rounded-full text-base font-semibold ring-1 ring-inset"
                  [ngClass]="{
                    'bg-amber-100 text-amber-700 ring-amber-200 dark:bg-amber-900/40 dark:text-amber-200 dark:ring-amber-800':
                      i === 0,
                    'bg-slate-100 text-slate-700 ring-slate-200 dark:bg-slate-800 dark:text-slate-200 dark:ring-slate-700':
                      i > 2
                  }"
                  [title]="'Rang ' + (i + 1)"
                >
                  {{ i === 0 ? "ðŸ¥‡" : i === 1 ? "ðŸ¥ˆ" : i === 2 ? "ðŸ¥‰" : i + 1 }}
                </span>
              </td>

              <td class="px-2 py-3">
                <div class="font-medium text-slate-900 dark:text-slate-100">
                  {{ s.firstName }}
                </div>
                <div
                  class="mt-1 h-2 w-40 rounded-full bg-slate-200 dark:bg-slate-700"
                  aria-hidden="true"
                >
                  <div
                    class="h-2 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500"
                    [style.width.%]="
                      percentOf(toNum(s?.totalReserveInDollars), maxReserveUSD)
                    "
                  ></div>
                </div>
              </td>

              <td class="px-4 py-3 text-right whitespace-nowrap">
                <span class="font-medium text-slate-900 dark:text-slate-100">
                  {{ toNum(s?.totalReserve) | number : "1.0-0" }} FC
                </span>
              </td>

              <td class="px-4 py-3 text-right whitespace-nowrap">
                <span class="font-medium text-slate-900 dark:text-slate-100">
                  {{ toNum(s?.totalReserveInDollars) | number : "1.0-0" }} $
                </span>
                <span class="ml-2 text-xs text-slate-500 dark:text-slate-400">
                  {{
                    percentOf(toNum(s?.totalReserveInDollars), maxReserveUSD)
                      | number : "1.0-0"
                  }}%
                </span>
              </td>

              <td class="px-4 py-3 text-right">
                <span
                  class="inline-flex items-center justify-end gap-1 rounded-full px-2 py-1 text-xs font-semibold"
                  [ngClass]="nonNegColor(sortedGrowthRateMonth[i].growthRate)"
                >
                  <span>{{
                    toNum(sortedGrowthRateMonth[i].growthRate) >= 0 ? "â–²" : "â–¼"
                  }}</span>
                  <span
                    >{{
                      toNum(sortedGrowthRateMonth[i].growthRate) >= 0
                        ? "+"
                        : ""
                    }}{{
                      toNum(sortedGrowthRateMonth[i].growthRate)
                        | number : "1.0-0"
                    }}%</span
                  >
                </span>
              </td>
            </tr>
          </tbody>

          <tfoot
            class="bg-slate-50 text-sm dark:bg-slate-800 dark:text-slate-100"
          >
            <tr>
              <td class="px-4 py-3 font-semibold">Total</td>
              <td class="px-2 py-3"></td>
              <td class="px-4 py-3 text-right font-semibold">
                {{ toNum(givenMonthTotalReserveAmount) | number : "1.0-0" }} FC
              </td>
              <td class="px-4 py-3 text-right font-semibold">
                {{
                  toNum(givenMonthTotalReserveAmountDollars) | number : "1.0-0"
                }}
                $
              </td>
              <td class="px-4 py-3 text-right font-semibold">
                {{ toNum(growthRateTotal) | number : "1.0-0" }} %
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <!-- ====== PAIEMENT DU MOIS ====== -->
    <div
      class="rounded-2xl 2xl:max-w-3xl border border-slate-200 bg-white/70 p-5 shadow-sm backdrop-blur-md dark:border-slate-700 dark:bg-slate-900/60"
    >
      <div class="mb-4">
        <h2 class="text-xl font-semibold tracking-tight dark:text-slate-100">
          Classement Paiement Du Mois
          <span
            class="ml-1 bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent"
          >
            ({{ time.monthFrenchNames[givenMonth - 1] }} {{ givenYear }})
          </span>
        </h2>

        <div
          class="mt-3 flex flex-wrap items-center gap-3 text-sm text-slate-600 dark:text-slate-300"
        >
          <div
            class="rounded-full bg-emerald-100 px-2.5 py-1 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-200"
          >
            Total:
            {{ toNum(givenMonthTotalPaymentAmount) | number : "1.0-0" }} FC Â·
            {{ toNum(givenMonthTotalPaymentAmountDollars) | number : "1.0-0" }}
            $
          </div>
          <div
            class="rounded-full bg-slate-100 px-2.5 py-1 text-slate-700 dark:bg-slate-800 dark:text-slate-200"
          >
            Croissance:
            {{ toNum(growthRateTotalPayments) | number : "1.0-0" }} %
          </div>
          <div
            class="rounded-full bg-cyan-50 px-2.5 py-1 text-cyan-700 ring-1 ring-cyan-200 dark:bg-cyan-900/30 dark:text-cyan-200 dark:ring-cyan-800"
          >
            Barre = % du meilleur $
          </div>
        </div>
      </div>

      <div class="rounded-xl ring-1 ring-slate-200 dark:ring-slate-700">
        <table class="w-full table-auto text-sm font-normal tabular-nums">
          <thead
            class="bg-slate-50 text-xs uppercase tracking-wide text-slate-600 dark:bg-slate-800 dark:text-slate-300"
          >
            <tr>
              <th class="px-4 py-3 text-left">Rang</th>
              <th class="px-2 py-3 text-left">Ã‰quipe</th>
              <th class="px-4 py-3 text-right">Paiement (FC)</th>
              <th class="px-4 py-3 text-right">Paiement ($)</th>
              <th class="px-4 py-3 text-right">Î” Croissance</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
            <tr
              *ngFor="let s of sortedPaymentMonth; let i = index"
              class="odd:bg-white/90 even:bg-white/60 hover:bg-emerald-50/60 dark:odd:bg-slate-900/40 dark:even:bg-slate-900/30 dark:hover:bg-slate-800/60"
            >
              <td class="px-4 py-3">
                <span
                  class="inline-flex h-8 w-8 items-center justify-center rounded-full text-base font-semibold ring-1 ring-inset"
                  [ngClass]="{
                    'bg-amber-100 text-amber-700 ring-amber-200 dark:bg-amber-900/40 dark:text-amber-200 dark:ring-amber-800':
                      i === 0,
                    'bg-slate-100 text-slate-700 ring-slate-200 dark:bg-slate-800 dark:text-slate-200 dark:ring-slate-700':
                      i > 2
                  }"
                  [title]="'Rang ' + (i + 1)"
                >
                  {{ i === 0 ? "ðŸ¥‡" : i === 1 ? "ðŸ¥ˆ" : i === 2 ? "ðŸ¥‰" : i + 1 }}
                </span>
              </td>

              <td class="px-2 py-3">
                <div class="font-medium text-slate-900 dark:text-slate-100">
                  {{ s.firstName }}
                </div>
                <div
                  class="mt-1 h-2 w-40 rounded-full bg-slate-200 dark:bg-slate-700"
                  aria-hidden="true"
                >
                  <div
                    class="h-2 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500"
                    [style.width.%]="
                      percentOf(toNum(s?.totalPaymentInDollars), maxPaymentUSD)
                    "
                  ></div>
                </div>
              </td>

              <td class="px-4 py-3 text-right whitespace-nowrap">
                <span class="font-medium text-slate-900 dark:text-slate-100">
                  {{ toNum(s?.totalPayment) | number : "1.0-0" }} FC
                </span>
              </td>

              <td class="px-4 py-3 text-right whitespace-nowrap">
                <span class="font-medium text-slate-900 dark:text-slate-100">
                  {{ toNum(s?.totalPaymentInDollars) | number : "1.0-0" }} $
                </span>
                <span class="ml-2 text-xs text-slate-500 dark:text-slate-400">
                  {{
                    percentOf(toNum(s?.totalPaymentInDollars), maxPaymentUSD)
                      | number : "1.0-0"
                  }}%
                </span>
              </td>

              <td class="px-4 py-3 text-right">
                <span
                  class="inline-flex items-center justify-end gap-1 rounded-full px-2 py-1 text-xs font-semibold"
                  [ngClass]="
                    nonNegColor(sortedGrowthRatePaymentMonth[i].growthRate)
                  "
                >
                  <span>{{
                    toNum(sortedGrowthRatePaymentMonth[i].growthRate) >= 0
                      ? "â–²"
                      : "â–¼"
                  }}</span>
                  <span
                    >{{
                      toNum(sortedGrowthRatePaymentMonth[i].growthRate) >= 0
                        ? "+"
                        : ""
                    }}{{
                      toNum(sortedGrowthRatePaymentMonth[i].growthRate)
                        | number : "1.0-0"
                    }}%</span
                  >
                </span>
              </td>
            </tr>
          </tbody>

          <tfoot
            class="bg-slate-50 text-sm dark:bg-slate-800 dark:text-slate-100"
          >
            <tr>
              <td class="px-4 py-3 font-semibold">Total</td>
              <td class="px-2 py-3"></td>
              <td class="px-4 py-3 text-right font-semibold">
                {{ toNum(givenMonthTotalPaymentAmount) | number : "1.0-0" }} FC
              </td>
              <td class="px-4 py-3 text-right font-semibold">
                {{
                  toNum(givenMonthTotalPaymentAmountDollars) | number : "1.0-0"
                }}
                $
              </td>
              <td class="px-4 py-3 text-right font-semibold">
                {{ toNum(growthRateTotalPayments) | number : "1.0-0" }} %
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>
