<app-navbar
  [email]="auth.currentUser.email"
  [firstName]="auth.currentUser.firstName"
  [path]="'home'"
>
</app-navbar>

<!-- ‚ï≠‚îÄ Header & date picker ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 mt-8 space-y-6">
  <!-- headline + quick link (now centred) -->
  <div
    class="flex flex-col lg:flex-row items-center justify-center gap-6 text-center"
  >
    <h1
      class="text-3xl md:text-4xl font-extrabold tracking-tight text-green-800"
    >
      Activit√©s du&nbsp;{{ frenchDate }}
    </h1>

    <button
      routerLink="/client-info-current"
      class="inline-flex items-center gap-2 rounded-full bg-green-600 px-6 py-3 text-sm font-semibold text-white shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"
    >
      Info Clients
    </button>
  </div>

  <!-- date picker (centered) -->
  <!-- date picker (now truly centered) -->
  <div class="flex justify-center">
    <input
      [(ngModel)]="requestDate"
      type="date"
      class="mx-auto max-w-xs rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-green-500 focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white dark:border-gray-600"
      (change)="findDailyActivitiesAmount()"
      required
    />
  </div>
</section>

<!-- ‚ï≠‚îÄ Contr√¥le quotidien (collapsible) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<details
  [attr.open]="detailOpen ? '' : null"
  (toggle)="onDetailsToggle($event)"
  class="group mx-auto mt-6 max-w-5xl rounded-3xl border border-slate-200 dark:border-slate-700 shadow-xl overflow-hidden"
>
  <!-- Header -->
  <summary
    class="flex cursor-pointer flex-col gap-3 bg-gradient-to-r from-emerald-600 to-green-600 px-4 py-3 text-white sm:flex-row sm:items-center sm:justify-between sm:px-6 sm:py-4 hover:brightness-105 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60"
  >
    <!-- Left: icon + title + objective (center on mobile) -->
    <div
      class="flex flex-1 min-w-0 items-center justify-center gap-2 sm:justify-start"
    >
      <svg
        class="h-5 w-5 opacity-90 shrink-0"
        viewBox="0 0 24 24"
        fill="currentColor"
        aria-hidden="true"
      >
        <path
          d="M4 6a2 2 0 0 1 2-2h8l6 6v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6zm10 0v4a2 2 0 0 0 2 2h4"
        />
      </svg>

      <div class="min-w-0 text-center sm:text-left">
        <h3 class="truncate text-sm sm:text-base font-semibold tracking-wide">
          V√©rification quotidienne ‚Äî {{ frenchDate }}
        </h3>

        <!-- Objective line: turns slightly red when not OK; centered on mobile -->
        <p
          class="text-[11px] sm:text-xs/5 mt-0.5"
          [ngClass]="
            okCount === 3 ? 'text-white/90' : 'text-red-100 font-semibold'
          "
        >
          Objectif de cl√¥ture : En main = 0 ¬∑ Demand√© = 0 ¬∑ Raisons = 0
        </p>
      </div>
    </div>

    <!-- Right: chips + chevron -->
    <div
      class="flex items-center gap-2 sm:gap-3 justify-center sm:justify-end w-full sm:w-auto"
    >
      <!-- chips: scroll on xs, wrap on sm+ -->
      <div
        class="chips no-scrollbar -mx-1 flex max-w-full sm:max-w-none items-center gap-2 overflow-x-auto px-1 sm:flex-wrap"
      >
        <span
          class="whitespace-nowrap rounded-full px-3 py-1 text-[11px] font-semibold ring-1"
          [ngClass]="
            okCount === 3
              ? 'bg-white/15 text-white ring-white/40'
              : 'bg-yellow-300/30 text-yellow-100 ring-white/30'
          "
        >
          {{ okCount }}/3
          <ng-container *ngIf="okCount === 3">&nbsp;OK</ng-container>
          <ng-container *ngIf="okCount < 3">&nbsp;√† corriger</ng-container>
        </span>

        <span
          *ngIf="okCount < 3"
          class="whitespace-nowrap rounded-full bg-red-600/30 px-3 py-1 text-[11px] font-extrabold text-red-50 ring-1 ring-white/30"
        >
          Anomalies d√©tect√©es
        </span>
      </div>

      <!-- Chevron -->
      <svg
        class="ml-1 h-5 w-5 shrink-0 transition-transform duration-300 group-open:rotate-180"
        viewBox="0 0 20 20"
        fill="currentColor"
        aria-hidden="true"
      >
        <path
          fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
          clip-rule="evenodd"
        />
      </svg>
    </div>
  </summary>
  <!-- KPI strip -->
  <div class="bg-white dark:bg-slate-800">
    <div class="grid grid-cols-1 gap-3 p-4 sm:grid-cols-3 sm:gap-4 sm:p-5">
      <!-- En main (calcul√©) -->
      <div class="rounded-xl bg-indigo-50 dark:bg-slate-700/60 p-3 sm:p-4 relative">
        <div
          [class.blur-sm]="isMoneyLocked"
          [class.select-none]="isMoneyLocked"
          [class.pointer-events-none]="isMoneyLocked"
        >
          <div
            class="text-[11px] sm:text-xs uppercase tracking-wide text-slate-600 dark:text-slate-300"
          >
            Argent en main (calcul√©)
          </div>

          <!-- Top total: aligned, non-wrapping -->
          <div
            class="mt-1 text-base sm:text-lg font-bold text-slate-900 dark:text-slate-100 font-mono tabular-nums"
          >
            <span class="whitespace-nowrap"
              >{{ moneyInHandsTotalN | number : "1.0-0" }}&nbsp;FC</span
            >
            <span class="mx-1 opacity-60">¬∑</span>
            <span class="whitespace-nowrap"
              >{{
                compute.convertCongoleseFrancToUsDollars(
                  moneyInHandsTotalN.toString()
                ) | number : "1.0-0"
              }}&nbsp;$</span
            >
          </div>

          <!-- Traceability -->
          <div
            class="mt-2 rounded-lg bg-white/80 ring-1 ring-white/50 dark:bg-slate-800/40 dark:ring-white/10"
          >
            <div
              class="px-2.5 pt-2 text-[10px] sm:text-[11px] uppercase tracking-wide text-slate-500 dark:text-slate-300"
            >
              Tra√ßabilit√©
            </div>

            <!-- Entr√©es (two-column mini-ledger) -->
            <div class="px-2.5 mt-1.5">
              <div
                class="mb-1 inline-flex items-center rounded-full bg-emerald-100 text-emerald-800 ring-1 ring-emerald-200 px-2 py-0.5 text-[10px]"
              >
                Entr√©es
              </div>
              <div class="grid gap-1.5">
                <ng-container *ngFor="let p of formulaPlus">
                  <div class="grid grid-cols-[1fr_auto] items-center gap-x-3">
                    <div
                      class="text-[12px] sm:text-[13px] text-slate-700 dark:text-slate-200 truncate"
                    >
                      {{ p.label }}
                    </div>
                    <div
                      class="text-[12px] sm:text-[13px] font-bold text-emerald-700 dark:text-emerald-300 font-mono tabular-nums whitespace-nowrap"
                    >
                      +{{ p.v | number : "1.0-0" }}&nbsp;FC
                    </div>
                  </div>
                </ng-container>
                <div
                  *ngIf="formulaPlus.length === 0"
                  class="text-slate-400 text-[12px]"
                >
                  ‚Äî
                </div>
              </div>
            </div>

            <!-- Sorties (two-column mini-ledger) -->
            <div class="px-2.5 mt-2">
              <div
                class="mb-1 inline-flex items-center rounded-full bg-blue-100 text-blue-800 ring-1 ring-blue-200 px-2 py-0.5 text-[10px]"
              >
                Sorties
              </div>
              <div class="grid gap-1.5">
                <ng-container *ngFor="let m of formulaMinus">
                  <div class="grid grid-cols-[1fr_auto] items-center gap-x-3">
                    <div
                      class="text-[12px] sm:text-[13px] text-slate-700 dark:text-slate-200 truncate"
                    >
                      {{ m.label }}
                    </div>
                    <div
                      class="text-[12px] sm:text-[13px] font-bold text-blue-700 dark:text-blue-300 font-mono tabular-nums whitespace-nowrap"
                    >
                      ‚àí{{ m.v | number : "1.0-0" }}&nbsp;FC
                    </div>
                  </div>
                </ng-container>
                <div
                  *ngIf="formulaMinus.length === 0"
                  class="text-slate-400 text-[12px]"
                >
                  ‚Äî
                </div>
              </div>
            </div>

            <!-- Œ£ row (wraps nicely on xs, single line on sm+) -->
            <div
              class="mt-2 border-t border-white/70 dark:border-white/10 px-2.5 py-1.5"
            >
              <div class="grid gap-1 min-w-0">
                <div
                  class="text-[12px] sm:text-[13px] text-slate-600 dark:text-slate-300"
                >
                  Œ£ Entr√©es ‚Äì Œ£ Sorties
                </div>

                <div
                  class="flex flex-wrap items-center justify-between gap-x-2 gap-y-1 font-mono tabular-nums text-[12px] sm:text-sm leading-tight"
                >
                  <!-- equation (wraps as needed) -->
                  <div
                    class="flex flex-wrap items-center gap-x-1 gap-y-1 min-w-0"
                  >
                    <span
                      class="font-semibold text-slate-900 dark:text-slate-100"
                    >
                      {{ formulaPlusSumN | number : "1.0-0" }} FC
                    </span>
                    <span class="opacity-60">‚Äì</span>
                    <span
                      class="font-semibold text-slate-900 dark:text-slate-100"
                    >
                      {{ formulaMinusSumN | number : "1.0-0" }} FC
                    </span>
                    <span class="opacity-60">=</span>
                    <span
                      class="font-bold"
                      [ngClass]="
                        formulaNetN === moneyInHandsTotalN
                          ? 'text-slate-900 dark:text-slate-100'
                          : 'text-amber-700 dark:text-amber-300'
                      "
                    >
                      {{ formulaNetN | number : "1.0-0" }} FC
                    </span>
                  </div>

                  <!-- ecart pill (floats right on sm+, wraps under on xs) -->
                  <div
                    *ngIf="formulaNetN !== moneyInHandsTotalN"
                    class="inline-flex items-center rounded-full bg-amber-100 text-amber-800 ring-1 ring-amber-200 px-2 py-0.5 text-[10px] sm:text-[11px] font-mono tabular-nums"
                  >
                    √©cart
                    {{ formulaNetN - moneyInHandsTotalN | number : "1.0-0" }} FC
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          *ngIf="isMoneyLocked"
          class="absolute inset-0 flex flex-col items-center justify-center gap-2 bg-white/70 text-slate-600 dark:bg-slate-900/70 dark:text-slate-200"
        >
          <button
            type="button"
            (click)="openCodeModal()"
            class="rounded-full bg-gray-300/70 p-3 text-2xl shadow hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-slate-600 dark:text-gray-100"
            aria-label="D√©verrouiller la section Argent en main"
          >
            üîí
          </button>
          <span class="text-xs font-semibold uppercase tracking-wide"
            >Contenu verrouill√©</span
          >
          <span class="text-[11px] text-center font-medium"
            >Entrez le code pour afficher ¬´ Argent en main ¬ª</span
          >
        </div>
      </div>

      <!-- Demand√© (Total du jour) -->
      <div class="rounded-xl bg-indigo-50 dark:bg-slate-700/60 p-3 sm:p-4">
        <div
          class="text-[11px] sm:text-xs uppercase tracking-wide text-slate-600 dark:text-slate-300"
        >
          Argent demand√© (Total du jour)
        </div>
        <div
          class="mt-1 text-base sm:text-lg font-bold text-slate-900 dark:text-slate-100"
        >
          {{ requestTotalToday | number : "1.0-0" }} FC ¬∑
          {{
            compute.convertCongoleseFrancToUsDollars(
              requestTotalToday.toString()
            ) | number : "1.0-0"
          }}
          $
        </div>
      </div>

      <!-- Statut global + deltas -->
      <div
        class="rounded-xl p-3 sm:p-4"
        [ngClass]="{
          'bg-emerald-50 dark:bg-emerald-900/30': okCount === 3,
          'bg-amber-50 dark:bg-amber-900/30': okCount < 3
        }"
      >
        <div
          class="text-[11px] sm:text-xs uppercase tracking-wide text-slate-600 dark:text-slate-300"
        >
          Statut global
        </div>
        <div
          class="rounded-xl p-3 sm:p-4"
          [ngClass]="{
            'bg-emerald-50 dark:bg-emerald-900/30': okCount === 3,
            'bg-amber-50 dark:bg-amber-900/30': okCount < 3
          }"
        >
          <div
            class="mt-1 text-base sm:text-lg font-bold"
            [ngClass]="{
              'text-emerald-700 dark:text-emerald-300': okCount === 3,
              'text-amber-700 dark:text-amber-300': okCount < 3
            }"
          >
            {{
              okCount === 3 ? "OK ‚Äî pr√™t √† cl√¥turer" : "√Ä traiter avant cl√¥ture"
            }}
          </div>
        </div>

        <!-- Dual deltas -->
        <div class="mt-3 space-y-2 text-[12px] sm:text-sm">
          <div class="flex items-center justify-between gap-3">
            <span class="text-slate-600 dark:text-slate-300">Œî En main</span>
            <span
              class="inline-flex items-center rounded-full px-2.5 py-0.5 ring-1"
              [ngClass]="
                moneyInHandsTotalN === 0
                  ? 'bg-emerald-100 text-emerald-700 ring-emerald-200'
                  : 'bg-amber-100 text-amber-700 ring-amber-200'
              "
            >
              {{ moneyInHandsTotalN | number : "1.0-0" }} FC ¬∑
              {{
                compute.convertCongoleseFrancToUsDollars(
                  moneyInHandsTotalN.toString()
                ) | number : "1.0-0"
              }}
              $
            </span>
          </div>

          <div class="flex items-center justify-between gap-3">
            <span class="text-slate-600 dark:text-slate-300">Œî Demand√©</span>
            <span
              class="inline-flex items-center rounded-full px-2.5 py-0.5 ring-1"
              [ngClass]="
                requestTotalToday === 0
                  ? 'bg-emerald-100 text-emerald-700 ring-emerald-200'
                  : 'bg-amber-100 text-amber-700 ring-amber-200'
              "
            >
              {{ requestTotalToday | number : "1.0-0" }} FC ¬∑
              {{
                compute.convertCongoleseFrancToUsDollars(
                  requestTotalToday.toString()
                ) | number : "1.0-0"
              }}
              $
            </span>
          </div>
          <div class="flex items-center justify-between gap-3">
            <span class="text-slate-600 dark:text-slate-300">Œî Raisons</span>
            <span
              class="inline-flex items-center rounded-full px-2.5 py-0.5 ring-1"
              [ngClass]="
                reasonsMissing === 0
                  ? 'bg-emerald-100 text-emerald-700 ring-emerald-200'
                  : 'bg-amber-100 text-amber-700 ring-amber-200'
              "
            >
              <!-- Show ‚úì OK when complete; otherwise X/Y missing -->
              <ng-container *ngIf="reasonsMissing === 0; else missingTpl"
                >‚úì OK</ng-container
              >
              <ng-template #missingTpl>
                {{ reasonsMissing }} / {{ reasonsTotal }} manquante{{
                  reasonsMissing > 1 ? "s" : ""
                }}
              </ng-template>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</details>
<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->
<ng-container *ngIf="!isSunday">
  <div class="mx-auto mt-6 max-w-5xl px-4 sm:px-6 lg:px-8">
    <div
      class="relative overflow-hidden rounded-2xl ring-1 border-l-8 p-5 sm:p-6 antialiased"
      [style.borderLeftColor]="compute.getGradientColor(clampedPerc)"
      [ngClass]="{
        'bg-red-700 text-slate-200 ring-red-600': clampedPerc === 0,
        'bg-rose-50 text-rose-800 ring-rose-300':
          clampedPerc > 0 && clampedPerc < 30,
        'bg-orange-50 text-orange-800 ring-orange-300':
          clampedPerc >= 30 && clampedPerc < 50,
        'bg-amber-50 text-amber-900 ring-amber-300':
          clampedPerc >= 50 && clampedPerc < 70,
        'bg-yellow-50 text-yellow-900 ring-yellow-300':
          clampedPerc >= 70 && clampedPerc < 80,
        'bg-green-600 text-white ring-green-500':
          clampedPerc >= 80 && clampedPerc < 90,
        'bg-emerald-700 text-white ring-emerald-600': clampedPerc >= 90
      }"
    >
      <div
        class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"
      >
        <div
          class="text-lg sm:text-xl font-extrabold tracking-tight flex items-center gap-2"
        >
          <ng-container [ngSwitch]="true">
            <span *ngSwitchCase="clampedPerc === 0"
              >üö® 0 % ‚Äî Pas encore de paiement</span
            >
            <span *ngSwitchCase="clampedPerc > 0 && clampedPerc < 30"
              >üß≠ Encore loin</span
            >
            <span *ngSwitchCase="clampedPerc >= 30 && clampedPerc < 50"
              >üëç Bon d√©but</span
            >
            <span *ngSwitchCase="clampedPerc >= 50 && clampedPerc < 70"
              >üí™ Bien jou√©</span
            >
            <span *ngSwitchCase="clampedPerc >= 70 && clampedPerc < 80"
              >‚úÖ Tr√®s bien</span
            >
            <span *ngSwitchCase="clampedPerc >= 80 && clampedPerc < 90"
              >üåü Super travail</span
            >
            <span *ngSwitchDefault>üèÜ Excellent</span>
          </ng-container>
        </div>

        <span
          class="inline-flex items-center rounded-full px-3 py-1 text-[12px] sm:text-sm font-bold ring-1 ring-inset bg-white text-slate-900 shadow-sm cursor-pointer"
          [style.borderColor]="compute.getGradientColor(clampedPerc)"
          aria-label="Statut du jour"
          (click)="!canShowPercentage && openCodeModal()"
          [title]="!canShowPercentage ? 'Cliquez pour d√©verrouiller le pourcentage' : ''"
        >
          <ng-container *ngIf="canShowPercentage; else hiddenPercentage">
            {{ percentage }} %
          </ng-container>
          <ng-template #hiddenPercentage>‚Ä¢‚Ä¢‚Ä¢</ng-template>
        </span>
      </div>

      <p class="mt-1 text-sm sm:text-base font-medium opacity-95">
        <ng-container [ngSwitch]="true">
          <span *ngSwitchCase="clampedPerc === 0"
            >On s‚Äôy met maintenant : vous pouvez le faire üí™</span
          >
          <span *ngSwitchCase="clampedPerc > 0 && clampedPerc < 30"
            >C‚Äôest un d√©but ; continuez, chaque visite compte.</span
          >
          <span *ngSwitchCase="clampedPerc >= 30 && clampedPerc < 50"
            >Beau rythme ‚Äî cap sur 50 %, puis 70 %.</span
          >
          <span *ngSwitchCase="clampedPerc >= 50 && clampedPerc < 70"
            >Vous √™tes sur la bonne voie ‚Äî poussez jusqu‚Äô√† 70 %.</span
          >
          <span *ngSwitchCase="clampedPerc >= 70 && clampedPerc < 80"
            >Derni√®re ligne droite vers 80 %.</span
          >
          <span *ngSwitchCase="clampedPerc >= 80 && clampedPerc < 90"
            >Plus que quelques pas vers 90 %.</span
          >
          <span *ngSwitchDefault
            >Vous √™tes une inspiration ‚Äî cap sur 100 % !</span
          >
        </ng-container>
      </p>

      <div class="mt-4">
        <div
          class="h-2 w-full rounded-full overflow-hidden"
          [ngClass]="{
            'bg-white/30': clampedPerc === 0 || clampedPerc >= 80,
            'bg-black/10': clampedPerc > 0 && clampedPerc < 80
          }"
        >
          <div
            class="h-2 rounded-full"
            [style.width.%]="clampedPerc"
            [style.background]="compute.getGradientColor(clampedPerc)"
          ></div>
        </div>
        <div class="mt-2 text-xs opacity-95">
          <ng-container *ngIf="canShowPercentage; else hiddenPercentageText">
            Objectif du jour atteint √† <strong>{{ percentage }} %</strong>.
          </ng-container>
          <ng-template #hiddenPercentageText>
            Objectif du jour atteint √† <strong>‚Ä¢‚Ä¢‚Ä¢</strong>.
            <button
              (click)="openCodeModal()"
              class="ml-2 text-xs underline hover:no-underline"
            >
              D√©verrouiller
            </button>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

<!-- ‚ï≠‚îÄ Weekly payment admin summary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<section class="mx-auto mt-10 max-w-5xl px-4 sm:px-6 lg:px-8">
  <div
    class="rounded-3xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800"
  >
    <div class="border-b border-slate-100 px-5 py-4 dark:border-slate-700">
      <h3 class="text-base font-semibold text-slate-800 dark:text-slate-100">
        Paiement Semaine ‚Äî Synth√®se
      </h3>
      <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
        Semaine de Lundi √† Dimanche
      </p>
    </div>

    <div class="grid gap-4 p-5 sm:grid-cols-3">
      <div class="space-y-2">
        <label class="text-xs font-semibold text-slate-600 dark:text-slate-300"
          >D√©but de semaine (Lundi)</label
        >
        <ng-container *ngIf="auth.isAdmin; else weekStartReadOnly">
          <input
            [(ngModel)]="weekPickerStartDate"
            type="date"
            class="w-full rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 focus:border-green-500 focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white dark:border-gray-600"
            (change)="updateWeekPickerTotals()"
          />
        </ng-container>
        <ng-template #weekStartReadOnly>
          <div
            class="rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 dark:border-slate-600 dark:bg-slate-700/40 dark:text-slate-200"
          >
            {{ weekPickerStartLabel || weekPickerStartDate }}
          </div>
        </ng-template>
      </div>

      <div class="space-y-2">
        <label class="text-xs font-semibold text-slate-600 dark:text-slate-300"
          >Fin de semaine (Dimanche)</label
        >
        <div
          class="rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 dark:border-slate-600 dark:bg-slate-700/40 dark:text-slate-200"
        >
          {{ weekPickerEndLabel }}
        </div>
      </div>
      <div class="space-y-2">
        <label class="text-xs font-semibold text-slate-600 dark:text-slate-300"
          >Total Paiement</label
        >
        <div
          class="rounded-lg border border-emerald-100 bg-emerald-50 px-3 py-2 text-sm text-emerald-800 dark:border-emerald-900/40 dark:bg-emerald-900/20 dark:text-emerald-200"
        >
          <ng-container *ngIf="isPayUnlocked || auth.isAdmin; else weeklyTotalHidden">
            FC&nbsp;{{ weekPickerTotalN | number : "1.0-0" }}
            <span class="mx-1 text-emerald-300">¬∑</span>
            $&nbsp;{{ weekPickerTotalDollars | number : "1.0-0" }}
          </ng-container>
          <ng-template #weeklyTotalHidden>
            ‚Ä¢‚Ä¢‚Ä¢
            <button
              (click)="openCodeModal()"
              class="ml-2 rounded bg-emerald-200/70 px-2 py-0.5 text-xs text-emerald-800 hover:bg-emerald-300/70 dark:bg-emerald-900/40 dark:text-emerald-100"
            >
              üîí
            </button>
          </ng-template>
        </div>
      </div>
    </div>

    <div class="px-5 pb-4">
      <div class="flex items-center justify-between text-sm font-semibold">
        <span class="text-slate-600 dark:text-slate-300">
          Minimum
          <span
            class="ml-2 inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-sm font-bold text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200"
          >
            {{ weeklyTargetFc | number : "1.0-0" }} FC
          </span>
        </span>
        <span
          [ngClass]="
            weekPickerTargetReached ? 'text-emerald-600' : 'text-red-600'
          "
        >
          {{ weekPickerTargetReached ? 'Atteint' : '√Ä faire' }}
        </span>
      </div>
      <div
        *ngIf="hasProjectedWeeklyTarget"
        class="mt-2 rounded-xl border-l-4 border-emerald-500 bg-gradient-to-r from-emerald-50 via-white to-transparent px-3 py-2 shadow-sm dark:border-emerald-400 dark:from-emerald-900/20 dark:via-slate-900/30"
      >
        <div class="flex items-start gap-2">
          <span
            class="inline-flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-emerald-600 text-[10px] font-black text-white"
            >‚Üë</span
          >
          <div>
            <div class="text-[10px] font-black uppercase tracking-wide text-emerald-800 dark:text-emerald-200">
              Nouveau minimum bient√¥t
            </div>
            <div class="text-[13px] font-extrabold text-slate-900 dark:text-slate-100">
              {{ projectedWeeklyTargetFc | number : "1.0-0" }} FC
            </div>
            <div class="text-[11px] text-slate-600 dark:text-slate-400">
              Effectif d√®s le {{ projectedWeeklyTargetEffectiveDateLabel }}.
            </div>
          </div>
        </div>
      </div>
      <div
        class="mt-1 h-2 w-full rounded-full bg-red-100 dark:bg-red-900/30 overflow-hidden"
      >
        <div
          class="h-2 rounded-full transition-all duration-300"
          [ngClass]="
            weekPickerTargetReached ? 'bg-emerald-500' : 'bg-red-500'
          "
          [style.width.%]="weekPickerProgressPercent"
        ></div>
      </div>
      <div class="mt-1 text-center text-[11px] text-slate-500">
        {{ weekPickerProgressPercent | number : "1.0-0" }}% atteint
      </div>
    </div>

    <div
      class="px-5 pb-2"
      *ngIf="weeklyShortfalls.length > 0 || auth.isAdmin"
    >
      <div
        class="rounded-2xl border border-rose-400 bg-gradient-to-br from-amber-50 via-white to-amber-100/40 p-4 text-[11px] text-slate-700 shadow-sm"
      >
        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-2 font-semibold text-slate-800">
            <span
              class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-amber-200/70 text-amber-900"
              >!</span
            >
            <span>Semaines sous objectif</span>
          </div>
          <span
            class="rounded-full bg-amber-900 px-2.5 py-0.5 text-[10px] font-semibold text-amber-50"
          >
            -$5 / personne
          </span>
        </div>
        <div
          *ngIf="auth.isAdmin"
          class="mt-2 flex items-center justify-end gap-2 text-[10px] text-slate-600"
        >
          <label for="shortfallMonth" class="font-semibold">Mois</label>
          <input
            id="shortfallMonth"
            type="month"
            [(ngModel)]="selectedShortfallMonth"
            (change)="onShortfallMonthChange()"
            class="rounded border border-amber-200 bg-white px-2 py-1 text-[10px]"
          />
        </div>
        <div class="mt-1 text-[10px] text-slate-600">
          Deduction appliquee uniquement apres fin de semaine.
        </div>

        <div
          class="mt-2 space-y-2"
          *ngIf="weeklyShortfalls.length > 0; else noWeeklyShortfalls"
        >
          <div
            *ngFor="let w of weeklyShortfalls"
            class="flex items-center justify-between gap-3 rounded-xl border-4 border-rose-600 bg-white/80 px-3 py-2 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.5)]"
          >
            <div class="flex min-w-0 flex-1 items-center justify-between gap-3">
              <div class="min-w-0 flex items-start gap-2">
                <span class="mt-1 h-2 w-2 shrink-0 rounded-full bg-rose-500"></span>
                <div>
                  <div class="text-[12px] font-semibold text-slate-800">
                    {{ w.label }}
                  </div>
                  <div class="text-[10px] text-rose-600">
                    Deduction appliquee
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-[12px] font-semibold text-slate-900">
                  <ng-container *ngIf="isPayUnlocked || auth.isAdmin; else weeklyShortfallHidden">
                    FC&nbsp;{{ w.totalFc | number : "1.0-0" }}
                    <span class="mx-1 text-slate-300">¬∑</span>
                    $&nbsp;{{ w.totalUsd | number : "1.0-0" }}
                  </ng-container>
                  <ng-template #weeklyShortfallHidden>‚Ä¢‚Ä¢‚Ä¢</ng-template>
                </div>
                <div class="text-[10px] text-slate-500">
                  Objectif: {{ weeklyTargetFc | number : "1.0-0" }} FC
                </div>
                <div
                  *ngIf="hasProjectedWeeklyTarget"
                  class="mt-1 inline-flex items-center gap-1.5 rounded-md border border-emerald-300 bg-emerald-50 px-2 py-0.5 text-[10px] font-extrabold text-emerald-800 dark:border-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-200"
                >
                  <span
                    class="inline-flex h-3.5 w-3.5 items-center justify-center rounded-full bg-emerald-600 text-[9px] font-black text-white"
                    >‚Üë</span
                  >
                  Nouveau minimum bient√¥t: {{ projectedWeeklyTargetFc | number : "1.0-0" }} FC
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noWeeklyShortfalls>
          <div class="mt-2 text-[11px] text-slate-500">
            Aucune semaine en dessous du minimum.
          </div>
        </ng-template>
      </div>
    </div>

    <div class="px-5 pb-5 text-[11px] text-slate-500 dark:text-slate-400">
      Semaine s√©lectionn√©e : {{ weekPickerRangeLabel }}
    </div>
  </div>
</section>
<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

<!-- ‚ï≠‚îÄ Performance & reserve ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<section class="mx-auto mt-12 max-w-3xl px-4 sm:px-6 lg:px-8">
  <!-- ‚îÄ‚îÄ Performance cards ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <ng-container *ngIf="isPayUnlocked || auth.isAdmin; else perfMasked">
    <ng-container *ngIf="expectedReserve === '0'">
      <div class="mb-8 rounded-2xl bg-green-50 p-6 text-center shadow">
        <h2 class="text-xl font-semibold text-green-800 dark:text-green-300">
          Performance Paiement du Jour
        </h2>
        <p class="mt-2 text-3xl font-extrabold text-green-900">____%</p>
      </div>
    </ng-container>

    <ng-container *ngIf="expectedReserve !== '0' && perc >= 50">
      <div class="mb-8 rounded-2xl bg-green-50 p-6 text-center shadow">
        <h2 class="text-xl font-semibold text-green-800">
          Performance Paiement du Jour
        </h2>
        <p class="mt-2 text-3xl font-extrabold text-green-900">
          <ng-container *ngIf="canShowPercentage; else hiddenPerfPercentage">
            {{ percentage }}%
          </ng-container>
          <ng-template #hiddenPerfPercentage>‚Ä¢‚Ä¢‚Ä¢</ng-template>
        </p>
      </div>
    </ng-container>

    <ng-container *ngIf="expectedReserve !== '0' && perc < 50">
      <div class="mb-8 rounded-2xl bg-red-50 p-6 text-center shadow">
        <h2 class="text-xl font-semibold text-red-800">
          Performance Paiement du Jour
        </h2>
        <p class="mt-2 text-3xl font-extrabold text-red-900">
          <ng-container *ngIf="canShowPercentage; else hiddenPerfPercentage2">
            {{ percentage }}%
          </ng-container>
          <ng-template #hiddenPerfPercentage2>‚Ä¢‚Ä¢‚Ä¢</ng-template>
        </p>
      </div>
    </ng-container>
  </ng-container>

  <!-- masked version with padlock -->
  <ng-template #perfMasked>
    <div
      class="relative mb-8 rounded-2xl bg-gray-100 p-6 text-center shadow dark:bg-slate-700"
    >
      <h2 class="text-xl font-semibold text-gray-500 dark:text-gray-300">
        Performance Paiement du Jour
      </h2>
      <p class="mt-2 text-3xl font-extrabold text-gray-400">‚Ä¢‚Ä¢‚Ä¢</p>

      <!-- padlock -->
      <button
        (click)="openCodeModal()"
        class="absolute top-3 right-3 rounded-full bg-gray-300/70 p-2 text-gray-700 hover:bg-gray-400 dark:bg-slate-600 dark:text-gray-100"
      >
        üîí
      </button>
    </div>
  </ng-template>
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

  <!-- ‚îÄ‚îÄ Reserve card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="rounded-2xl bg-white p-8 shadow dark:bg-slate-800">
    <h3
      class="mb-6 text-center text-2xl font-bold text-green-800 underline dark:text-green-300"
    >
      Reserve
    </h3>

    <!-- expected reserve -->
    <div class="mb-6 rounded-lg bg-gray-50 p-4 shadow-sm dark:bg-slate-700">
      <h4 class="mb-1 text-lg font-semibold text-green-800 dark:text-green-300">
        Reserve Attendue du Jour
      </h4>
      <p class="text-xl font-bold text-green-900 dark:text-green-200">
        {{ expectedReserve | number : "1.0-0" }} FC
        <span class="mx-1 text-gray-500 dark:text-gray-400">‚Üí</span>
        {{ expectedReserveInDollars | number : "1.0-0" }} $
      </p>
    </div>

    <!-- daily reserve / payment -->
    <div class="rounded-lg bg-gray-50 p-4 shadow-sm dark:bg-slate-700">
      <h4 class="mb-1 text-lg font-semibold text-green-800 dark:text-green-300">
        Paiement du Jour
        <button
          *ngIf="!isPayUnlocked && !auth.isAdmin"
          (click)="openCodeModal()"
          class="ml-2 rounded bg-gray-300/70 px-2 py-0.5 text-xs text-gray-700 hover:bg-gray-400 dark:bg-slate-600 dark:text-gray-100"
        >
          üîí
        </button>
      </h4>

      <p
        class="mb-3 text-xl font-bold"
        [ngClass]="
          isPayUnlocked || auth.isAdmin
            ? 'text-green-900 dark:text-green-200'
            : 'text-gray-400 dark:text-gray-500'
        "
      >
        <ng-container *ngIf="isPayUnlocked || auth.isAdmin; else payDash">
          {{ dailyPayment | number : "1.0-0" }} FC
          <span class="mx-1 text-gray-500 dark:text-gray-400">‚Üí</span>
          {{ dailyPaymentDollars | number : "1.0-0" }} $
        </ng-container>
        <ng-template #payDash>‚Ä¢‚Ä¢‚Ä¢</ng-template>
      </p>

      <h4 class="mb-1 text-lg font-semibold text-green-800 dark:text-green-300">
        Reserve du Jour
      </h4>
      <p class="text-xl font-bold text-green-900 dark:text-green-200">
        {{ dailyReserve | number : "1.0-0" }} FC
        <span class="mx-1 text-gray-500 dark:text-gray-400">‚Üí</span>
        {{
          compute.convertCongoleseFrancToUsDollars(dailyReserve)
            | number : "1.0-0"
        }}
        $
      </p>
    </div>
  </div>
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
</section>
<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

<!-- ‚ï≠‚îÄ Daily Collections (Simple) + Recruiting ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<section class="mx-auto mt-10 max-w-7xl px-4 sm:px-6 lg:px-8">
  <details
    class="group rounded-3xl ring-1 ring-slate-200 dark:ring-slate-700 overflow-hidden"
  >
    <!-- Header -->
    <summary
      class="flex cursor-pointer items-center justify-between gap-4 bg-gradient-to-r from-emerald-600 to-green-600 px-5 py-4 text-white hover:brightness-105 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60"
    >
      <div class="flex flex-col">
        <span class="text-lg font-extrabold tracking-tight">
          Programme de la journ√©e (08:30‚Äì16:30) ‚Äî Version simple
        </span>
        <span class="text-xs/5 opacity-90"> </span>
      </div>

      <!-- Principle chips (minimal) -->
      <div class="hidden md:flex flex-wrap items-center gap-2">
        <span
          class="rounded-full bg-white/15 px-3 py-1 text-[11px] font-semibold"
          >‚úì Partiels OK</span
        >
        <span
          class="rounded-full bg-white/15 px-3 py-1 text-[11px] font-semibold"
          >‚úì Heure + montant</span
        >
        <span
          class="rounded-full bg-white/15 px-3 py-1 text-[11px] font-semibold"
          >‚úì Retour m√™me jour</span
        >

        <!-- Recruiting mode (toggle if you want) -->
        <span
          class="rounded-full bg-yellow-300/30 px-3 py-1 text-[11px] font-extrabold text-yellow-100 ring-1 ring-white/30"
        >
          üöÄ Recrutement prioritaire
        </span>
      </div>

      <!-- Chevron -->
      <svg
        class="h-5 w-5 shrink-0 transition-transform duration-300 group-open:rotate-180"
        viewBox="0 0 20 20"
        fill="currentColor"
        aria-hidden="true"
      >
        <path
          fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
          clip-rule="evenodd"
        />
      </svg>
    </summary>

    <!-- Content -->
    <div class="bg-white dark:bg-slate-800">
      <!-- Mobile chips -->
      <div class="md:hidden flex flex-wrap gap-2 px-5 pt-4">
        <span
          class="rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300"
          >‚úì Partiels OK</span
        >
        <span
          class="rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300"
          >‚úì Heure + montant</span
        >
        <span
          class="rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300"
          >‚úì Retour m√™me jour</span
        >
        <span
          class="rounded-full bg-yellow-100 px-2.5 py-1 text-[11px] font-semibold text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"
          >üöÄ Recrutement</span
        >
      </div>

      <!-- Simple time blocks -->
      <ol class="grid gap-4 p-5 md:grid-cols-2 lg:grid-cols-3">
        <!-- 08:00‚Äì08:30 Plan -->
        <li
          class="rounded-2xl border border-slate-200 p-4 hover:shadow-md dark:border-slate-700"
        >
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold text-slate-500 dark:text-slate-400"
              >08:30‚Äì09:05</span
            >
            <span
              class="rounded-full bg-green-100 px-2 py-0.5 text-[10px] font-bold text-green-700 dark:bg-green-900/30 dark:text-green-300"
              >Plan du jour</span
            >
          </div>
          <p class="mt-1 text-sm text-slate-700 dark:text-slate-300">
            Lister les clients √† visiter aujourd‚Äôhui + restant d‚Äôhier (√† inclure
            absolument).
          </p>
          <p class="mt-1 text-sm text-slate-700 dark:text-slate-300">
            Qui fait quoi, qui visite qui, et qui reste au bureau.
          </p>
        </li>

        <!-- 08:30‚Äì09:00 R√©partition -->
        <!-- <li class="rounded-2xl border border-slate-200 p-4 hover:shadow-md dark:border-slate-700">
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold text-slate-500 dark:text-slate-400">08:30‚Äì09:00</span>
            <span class="rounded-full bg-green-100 px-2 py-0.5 text-[10px] font-bold text-green-700 dark:bg-green-900/30 dark:text-green-300">R√©partition</span>
          </div>
         
        </li> -->

        <!-- 09:00‚Äì12:00 Visite 1 + Recrutement -->
        <li
          class="rounded-2xl border border-slate-200 p-4 hover:shadow-md dark:border-slate-700"
        >
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold text-slate-500 dark:text-slate-400"
              >09:00‚Äì12:00</span
            >
            <span
              class="rounded-full bg-emerald-100 px-2 py-0.5 text-[10px] font-bold text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300"
              >Tourn√©e 1</span
            >
          </div>
          <p class="mt-1 text-sm text-slate-700 dark:text-slate-300">
            Visites sur terrain. <strong>Recruter</strong> en parall√®le.
          </p>
        </li>

        <!-- 12:00‚Äì13:00 Pause -->
        <li
          class="rounded-2xl border border-amber-200 bg-amber-50 p-4 hover:shadow-md dark:border-amber-900/40 dark:bg-amber-900/20"
        >
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold text-amber-700 dark:text-amber-300"
              >12:00‚Äì13:00</span
            >
            <span
              class="rounded-full bg-amber-200 px-2 py-0.5 text-[10px] font-bold text-amber-800 dark:bg-amber-900/60 dark:text-amber-200"
              >Pause</span
            >
          </div>
          <p class="mt-1 text-sm text-amber-800 dark:text-amber-300">
            D√©jeuner & pr√©paration apr√®s‚Äëmidi.
          </p>
        </li>

        <!-- 13:00‚Äì15:00 Visite 2 + Recrutement -->
        <li
          class="rounded-2xl border border-slate-200 p-4 hover:shadow-md dark:border-slate-700"
        >
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold text-slate-500 dark:text-slate-400"
              >13:00‚Äì15:00</span
            >
            <span
              class="rounded-full bg-emerald-100 px-2 py-0.5 text-[10px] font-bold text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300"
              >Tourn√©e 2</span
            >
          </div>
          <p class="mt-1 text-sm text-slate-700 dark:text-slate-300">
            Visites terrain + <strong>recrutement</strong> (mini‚Äëpitch).
          </p>
        </li>

        <!-- 15:00‚Äì16:30 Appels finaux + R√©serve -->
        <li
          class="rounded-2xl border border-slate-200 p-4 hover:shadow-md dark:border-slate-700"
        >
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold text-slate-500 dark:text-slate-400"
              >15:00‚Äì16:30</span
            >
            <span
              class="rounded-full bg-slate-100 px-2 py-0.5 text[10px] font-bold text-slate-700 dark:bg-slate-900/30 dark:text-slate-200"
              >Cl√¥ture</span
            >
          </div>
          <p class="mt-1 text-sm text-slate-700 dark:text-slate-300">
            Appels finaux + passages express si besoin. Finaliser le syst√®me et
            <strong>mettre la r√©serve</strong>.
          </p>
          <p class="mt-2 text-xs text-slate-500 dark:text-slate-400">
            ‚öë <strong>R√©serve = 0 / Paiement = 0 ‚Üí ‚ÄúN√©ant‚Äù.</strong> Maintenir
            la saisie <strong>temps r√©el</strong> pendant les encaissements.
          </p>
        </li>
      </ol>

      <!-- Compact recruiting target (optional) -->
      <div class="mx-5 mb-5 mt-1 flex flex-wrap items-center gap-2">
        <span
          class="rounded-full bg-sky-50 px-3 py-1 text-[11px] font-semibold text-sky-700 dark:bg-sky-900/30 dark:text-sky-300"
        >
          üéØ Objectif Recrutement¬†: 6 leads / 2 qualifi√©s
        </span>
        <span
          class="rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-700 dark:bg-slate-700 dark:text-slate-100"
        >
          ¬´ Le but, ce n‚Äôest pas la perfection, c‚Äôest le progr√®s : le but, c‚Äôest
          de s‚Äôam√©liorer. ¬ª
        </span>
      </div>
    </div>
  </details>
</section>
<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

<!-- ‚ï≠‚îÄ Summary cards ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<section class="mx-auto mt-16 max-w-7xl px-4 sm:px-6 lg:px-8">
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3">
    <!-- Tile #2 : ¬´ Paiement Du Jour ¬ª ----------------------------- -->
    <ng-container *ngIf="true">
      <!-- unlocked : normal link -->
      <a
        *ngIf="isPayUnlocked || auth.isAdmin"
        routerLink="{{ linkPaths[1] }}"
        class="group relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-700 dark:bg-slate-900"
      >
        <div class="flex items-start gap-4">
          <span
            class="inline-flex h-12 w-12 items-center justify-center rounded-xl ring-1 ring-inset bg-sky-50 text-sky-600 ring-sky-200"
          >
            <img
              [src]="imagePaths[1]"
              alt=""
              class="h-6 w-6 object-contain"
              loading="lazy"
            />
          </span>
          <div class="min-w-0 flex-1">
            <p class="text-[11px] uppercase tracking-wide text-slate-400">
              Indicateur #2
            </p>
            <h3
              class="mt-1 text-base font-semibold text-slate-900 dark:text-slate-100"
            >
              {{ summary[1] }}
            </h3>
            <div class="mt-4 space-y-1">
              <p
                class="text-2xl font-semibold text-emerald-600 dark:text-emerald-300"
              >
                FC {{ summaryContent[1] | number : "1.0-0" }}
              </p>
              <p class="text-sm text-slate-500 dark:text-slate-400">
                ‚âà $ {{ valuesConvertedToDollars[1] | number : "1.0-0" }}
              </p>
            </div>
          </div>
        </div>

        <div class="mt-6">
          <span
            class="inline-flex items-center gap-1 text-xs font-medium text-emerald-600 transition group-hover:text-emerald-700 dark:text-emerald-300 dark:group-hover:text-emerald-200"
          >
            Ouvrir
            <svg
              class="h-3.5 w-3.5"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="m9 18 6-6-6-6" />
            </svg>
          </span>
        </div>

        <div
          class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-transparent transition group-hover:ring-emerald-200"
        ></div>
      </a>

      <!-- locked : whole card is a button -->
      <button
        *ngIf="!isPayUnlocked && !auth.isAdmin"
        (click)="openCodeModal()"
        class="group relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white p-5 text-left shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-700 dark:bg-slate-900 w-full"
      >
        <div class="flex items-start gap-4 opacity-70">
          <span
            class="inline-flex h-12 w-12 items-center justify-center rounded-xl ring-1 ring-inset bg-slate-100 text-slate-400 ring-slate-200 dark:bg-slate-800 dark:text-slate-500 dark:ring-slate-700"
          >
            <img
              [src]="imagePaths[1]"
              alt=""
              class="h-6 w-6 object-contain opacity-40"
              loading="lazy"
            />
          </span>
          <div class="min-w-0 flex-1">
            <p class="text-[11px] uppercase tracking-wide text-slate-400">
              Indicateur #2
            </p>
            <h3 class="mt-1 text-base font-semibold text-slate-500">
              {{ summary[1] }}
            </h3>
            <div class="mt-4 space-y-1 text-slate-300 dark:text-slate-600">
              <p class="text-2xl font-semibold">‚Ä¢‚Ä¢‚Ä¢</p>
              <p class="text-sm">‚Ä¢‚Ä¢‚Ä¢</p>
            </div>
          </div>
        </div>
        <div class="mt-6 inline-flex items-center gap-2 text-xs font-medium text-slate-400">
          üîí Verrouille
        </div>
        <div
          class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-transparent transition group-hover:ring-slate-200/60"
        ></div>
      </button>
    </ng-container>
    <!-- ------------------------------------------------------------ -->

    <!-- Tile #3 : ¬´ Paiement de la Semaine ¬ª ---------------------- -->
    <ng-container *ngIf="true">
      <!-- unlocked : normal card -->
      <a
        *ngIf="isPayUnlocked || auth.isAdmin"
        class="group relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-700 dark:bg-slate-900"
      >
        <div class="flex items-start gap-4">
          <span
            class="inline-flex h-12 w-12 items-center justify-center rounded-xl ring-1 ring-inset bg-amber-50 text-amber-600 ring-amber-200"
          >
            <img
              src="../../../assets/img/daily-reimbursement.png"
              alt=""
              class="h-6 w-6 object-contain"
              loading="lazy"
            />
          </span>
          <div class="min-w-0 flex-1">
            <p class="text-[11px] uppercase tracking-wide text-slate-400">
              Indicateur #3
            </p>
            <h3
              class="mt-1 text-base font-semibold text-slate-900 dark:text-slate-100"
            >
              Paiement de la Semaine
            </h3>
            <p class="mt-2 text-[11px] text-slate-500 dark:text-slate-400">
              Semaine : {{ weeklyRangeLabel }}
            </p>
            <div class="mt-3 space-y-1">
              <p
                class="text-2xl font-semibold text-emerald-600 dark:text-emerald-300"
              >
                FC {{ weeklyPaymentTotalN | number : "1.0-0" }}
              </p>
              <p class="text-sm text-slate-500 dark:text-slate-400">
                ‚âà $ {{ weeklyPaymentTotalDollars | number : "1.0-0" }}
              </p>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <div class="flex items-center justify-between text-[11px] font-semibold">
            <span class="text-slate-500 dark:text-slate-400">
              <strong>Minimum</strong>&nbsp;{{ weeklyTargetFc | number : "1.0-0" }} FC
            </span>
            <span
              [ngClass]="weeklyTargetReached ? 'text-emerald-600' : 'text-red-600'"
            >
              {{ weeklyTargetReached ? 'Atteint' : '√Ä faire' }}
            </span>
          </div>
          <div
            *ngIf="hasProjectedWeeklyTarget"
            class="mt-2 rounded-xl border-l-4 border-emerald-500 bg-gradient-to-r from-emerald-50 via-white to-transparent px-3 py-2 shadow-sm dark:border-emerald-400 dark:from-emerald-900/20 dark:via-slate-900/30"
          >
            <div class="flex items-start gap-2">
              <span
                class="inline-flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-emerald-600 text-[10px] font-black text-white"
                >‚Üë</span
              >
              <div>
                <div class="text-[10px] font-black uppercase tracking-wide text-emerald-800 dark:text-emerald-200">
                  Nouveau minimum bient√¥t
                </div>
                <div class="text-[13px] font-extrabold text-slate-900 dark:text-slate-100">
                  {{ projectedWeeklyTargetFc | number : "1.0-0" }} FC
                </div>
                <div class="text-[11px] text-slate-600 dark:text-slate-400">
                  Effectif d√®s le {{ projectedWeeklyTargetEffectiveDateLabel }}
                </div>
              </div>
            </div>
          </div>

          <div
            class="mt-1 h-2 w-full rounded-full bg-red-100 dark:bg-red-900/30 overflow-hidden"
          >
            <div
              class="h-2 rounded-full transition-all duration-300"
              [ngClass]="weeklyTargetReached ? 'bg-emerald-500' : 'bg-red-500'"
              [style.width.%]="weeklyProgressPercent"
            ></div>
          </div>

          <div class="mt-1 text-center text-[11px] text-slate-500">
            {{ weeklyProgressPercent | number : "1.0-0" }}% atteint
          </div>
        </div>

        <div
          class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-transparent transition group-hover:ring-emerald-200"
        ></div>
      </a>

      <!-- locked : whole card is a button -->
      <button
        *ngIf="!isPayUnlocked && !auth.isAdmin"
        (click)="openCodeModal()"
        class="group relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white p-5 text-left shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-700 dark:bg-slate-900 w-full"
      >
        <div class="flex items-start gap-4 opacity-70">
          <span
            class="inline-flex h-12 w-12 items-center justify-center rounded-xl ring-1 ring-inset bg-slate-100 text-slate-400 ring-slate-200 dark:bg-slate-800 dark:text-slate-500 dark:ring-slate-700"
          >
            <img
              src="../../../assets/img/daily-reimbursement.png"
              alt=""
              class="h-6 w-6 object-contain opacity-40"
              loading="lazy"
            />
          </span>
          <div class="min-w-0 flex-1">
            <p class="text-[11px] uppercase tracking-wide text-slate-400">
              Indicateur #3
            </p>
            <h3 class="mt-1 text-base font-semibold text-slate-500">
              Paiement de la Semaine
            </h3>
            <div class="mt-4 space-y-1 text-slate-300 dark:text-slate-600">
              <p class="text-2xl font-semibold">‚Ä¢‚Ä¢‚Ä¢</p>
              <p class="text-sm">‚Ä¢‚Ä¢‚Ä¢</p>
            </div>
          </div>
        </div>
        <div class="mt-6 inline-flex items-center gap-2 text-xs font-medium text-slate-400">
          üîí Verrouille
        </div>
        <div
          class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-transparent transition group-hover:ring-slate-200/60"
        ></div>
      </button>
    </ng-container>
    <!-- ------------------------------------------------------------ -->

    <!-- All other tiles -------------------------------------------- -->
    <ng-container *ngFor="let s of summary; let i = index">
      <ng-container *ngIf="i !== 1">
        <!-- Tile #7 : ¬´ Retrait √âpargne Du Jour ¬ª (locked for non-admin) -->
        <ng-container *ngIf="i === 7">
          <!-- unlocked : normal link -->
          <a
            *ngIf="isSavingUnlocked || auth.isAdmin"
            routerLink="{{ linkPaths[7] }}"
            class="group relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-700 dark:bg-slate-900"
          >
            <div class="flex items-start gap-4">
              <span
                class="inline-flex h-12 w-12 items-center justify-center rounded-xl ring-1 ring-inset"
                [ngClass]="{
                  'bg-emerald-50 text-emerald-600 ring-emerald-200': 7 % 3 === 0,
                  'bg-sky-50 text-sky-600 ring-sky-200': 7 % 3 === 1,
                  'bg-amber-50 text-amber-600 ring-amber-200': 7 % 3 === 2
                }"
              >
                <img
                  [src]="imagePaths[7]"
                  alt=""
                  class="h-6 w-6 object-contain"
                  loading="lazy"
                />
              </span>
              <div class="min-w-0 flex-1">
                <p class="text-[11px] uppercase tracking-wide text-slate-400">
                  Indicateur #8
                </p>
                <h3
                  class="mt-1 text-base font-semibold text-slate-900 dark:text-slate-100"
                >
                  {{ summary[7] }}
                </h3>
                <div class="mt-4 space-y-1">
                  <p
                    class="text-2xl font-semibold text-emerald-600 dark:text-emerald-300"
                  >
                    FC {{ summaryContent[7] | number : "1.0-0" }}
                  </p>
                  <p class="text-sm text-slate-500 dark:text-slate-400">
                    ‚âà $ {{ valuesConvertedToDollars[7] | number : "1.0-0" }}
                  </p>
                </div>
              </div>
            </div>

            <div class="mt-6">
              <span
                class="inline-flex items-center gap-1 text-xs font-medium text-emerald-600 transition group-hover:text-emerald-700 dark:text-emerald-300 dark:group-hover:text-emerald-200"
              >
                Ouvrir
                <svg
                  class="h-3.5 w-3.5"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="m9 18 6-6-6-6" />
                </svg>
              </span>
            </div>

            <div
              class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-transparent transition group-hover:ring-emerald-200"
            ></div>
          </a>

          <!-- locked : whole card is a button -->
          <button
            *ngIf="!isSavingUnlocked && !auth.isAdmin"
            (click)="openCodeModal()"
            class="group relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white p-5 text-left shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-700 dark:bg-slate-900 w-full"
          >
            <div class="flex items-start gap-4 opacity-70">
              <span
                class="inline-flex h-12 w-12 items-center justify-center rounded-xl ring-1 ring-inset bg-slate-100 text-slate-400 ring-slate-200 dark:bg-slate-800 dark:text-slate-500 dark:ring-slate-700"
              >
                <img
                  [src]="imagePaths[7]"
                  alt=""
                  class="h-6 w-6 object-contain opacity-40"
                  loading="lazy"
                />
              </span>
              <div class="min-w-0 flex-1">
                <p class="text-[11px] uppercase tracking-wide text-slate-400">
                  Indicateur #8
                </p>
                <h3 class="mt-1 text-base font-semibold text-slate-500">
                  {{ summary[7] }}
                </h3>
                <div class="mt-4 space-y-1 text-slate-300 dark:text-slate-600">
                  <p class="text-2xl font-semibold">‚Ä¢‚Ä¢‚Ä¢</p>
                  <p class="text-sm">‚Ä¢‚Ä¢‚Ä¢</p>
                </div>
              </div>
            </div>
            <div class="mt-6 inline-flex items-center gap-2 text-xs font-medium text-slate-400">
              üîí Verrouille
            </div>
            <div
              class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-transparent transition group-hover:ring-slate-200/60"
            ></div>
          </button>
        </ng-container>

        <!-- All other tiles (normal unlocked cards) -->
        <ng-container *ngIf="i !== 7">
          <a
            routerLink="{{ linkPaths[i] }}"
            class="group relative overflow-hidden rounded-2xl border border-slate-200/70 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:shadow-lg dark:border-slate-700 dark:bg-slate-900"
          >
            <div class="flex items-start gap-4">
              <span
                class="inline-flex h-12 w-12 items-center justify-center rounded-xl ring-1 ring-inset"
                [ngClass]="{
                  'bg-emerald-50 text-emerald-600 ring-emerald-200': i % 3 === 0,
                  'bg-sky-50 text-sky-600 ring-sky-200': i % 3 === 1,
                  'bg-amber-50 text-amber-600 ring-amber-200': i % 3 === 2
                }"
              >
                <img
                  [src]="imagePaths[i]"
                  alt=""
                  class="h-6 w-6 object-contain"
                  loading="lazy"
                />
              </span>
              <div class="min-w-0 flex-1">
                <p class="text-[11px] uppercase tracking-wide text-slate-400">
                  Indicateur #{{ i + 1 }}
                </p>
                <h3
                  class="mt-1 text-base font-semibold text-slate-900 dark:text-slate-100"
                >
                  {{ s }}
                </h3>
                <div class="mt-4 space-y-1">
                  <p
                    class="text-2xl font-semibold text-emerald-600 dark:text-emerald-300"
                  >
                    FC {{ summaryContent[i] | number : "1.0-0" }}
                  </p>
                  <p class="text-sm text-slate-500 dark:text-slate-400">
                    ‚âà $ {{ valuesConvertedToDollars[i] | number : "1.0-0" }}
                  </p>
                </div>
              </div>
            </div>

            <div class="mt-6">
              <span
                class="inline-flex items-center gap-1 text-xs font-medium text-emerald-600 transition group-hover:text-emerald-700 dark:text-emerald-300 dark:group-hover:text-emerald-200"
              >
                Ouvrir
                <svg
                  class="h-3.5 w-3.5"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="m9 18 6-6-6-6" />
                </svg>
              </span>
            </div>

            <div
              class="pointer-events-none absolute inset-0 rounded-2xl ring-1 ring-transparent transition group-hover:ring-emerald-200"
            ></div>
          </a>
        </ng-container>
      </ng-container>
    </ng-container>
    <!-- ------------------------------------------------------------ -->
  </div>
</section>
<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

<!-- ‚ï≠‚îÄ Admin daily update ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<section
  *ngIf="auth.isAdmin"
  class="mx-auto mt-16 max-w-7xl px-4 sm:px-6 lg:px-8"
>
  <h2
    class="mb-10 text-center text-3xl font-bold text-green-800 dark:text-green-300"
  >
    Modifier les montants du&nbsp;{{ frenchDate }}
  </h2>

  <div
    class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"
  >
    <div
      class="flex flex-col rounded-2xl bg-white p-6 shadow-lg dark:bg-slate-800"
    >
      <h3 class="mb-1 text-lg font-semibold text-gray-900 dark:text-gray-50">
        Paiement de la semaine (objectif)
      </h3>
      <p class="mb-3 text-sm text-gray-600 dark:text-gray-300">
        Valeur actuelle :
        <strong>{{ weeklyTargetFc | number : "1.0-0" }} FC</strong>
      </p>
      <div
        *ngIf="hasProjectedWeeklyTarget"
        class="mb-3 rounded-xl border-l-4 border-emerald-500 bg-gradient-to-r from-emerald-50 via-white to-transparent px-3 py-2 text-sm text-slate-800 shadow-sm dark:border-emerald-400 dark:from-emerald-900/20 dark:via-slate-900/30 dark:text-slate-100"
      >
        <span class="inline-flex items-center gap-1.5 font-black uppercase tracking-wide text-emerald-800 dark:text-emerald-200">
          <span
            class="inline-flex h-4 w-4 items-center justify-center rounded-full bg-emerald-600 text-[10px] text-white"
            >‚Üë</span
          >
          Nouveau minimum bient√¥t
        </span>
        <div class="mt-1 text-base font-extrabold text-slate-900 dark:text-slate-100">
          {{ projectedWeeklyTargetFc | number : "1.0-0" }} FC
        </div>
        <div class="text-[12px] text-slate-600 dark:text-slate-400">
          Effectif d√®s le {{ projectedWeeklyTargetEffectiveDateLabel }}
        </div>
      </div>

      <input
        [(ngModel)]="weeklyTargetInput"
        type="number"
        placeholder="Ex: 700000"
        class="mb-4 w-full rounded-lg border bg-gray-50 p-2.5 text-gray-900 focus:border-green-500 focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white dark:border-gray-600"
      />

      <button
        (click)="setWeeklyTargetForUser()"
        class="mt-auto w-full rounded-lg bg-red-600 py-2.5 text-sm font-medium text-white transition hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400"
      >
        Confirmer
      </button>
    </div>
    <ng-container *ngFor="let f of dailyFieldConfigs">
      <div
        class="flex flex-col rounded-2xl bg-white p-6 shadow-lg dark:bg-slate-800"
      >
        <h3 class="mb-1 text-lg font-semibold text-gray-900 dark:text-gray-50">
          {{ f.label }}
        </h3>
        <p class="mb-3 text-sm text-gray-600 dark:text-gray-300">
          Valeur actuelle :
          <strong>{{ auth.currentUser[f.key]?.[todayKey] || 0 }}</strong>
        </p>

        <input
          [(ngModel)]="f.input"
          type="number"
          placeholder="Entrez le montant"
          class="mb-4 w-full rounded-lg border bg-gray-50 p-2.5 text-gray-900 focus:border-green-500 focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white dark:border-gray-600"
        />

        <button
          (click)="setDailyField(f.key, f.input); f.input = ''"
          class="mt-auto w-full rounded-lg bg-red-600 py-2.5 text-sm font-medium text-white transition hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400"
        >
          Confirmer
        </button>
      </div>
    </ng-container>
  </div>
</section>
<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

<!-- ‚ï≠‚îÄ Credits & transports (modern, minimal) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ -->
<section class="mx-auto mt-16 max-w-md md:max-w-lg px-4 sm:px-6 lg:px-8">
  <div
    class="overflow-hidden rounded-2xl bg-white shadow-xl ring-1 ring-black/5 dark:bg-slate-900 dark:ring-white/10"
  >
    <!-- Header: soft gradient + search -->
    <div
      class="flex items-center justify-between px-4 py-3 bg-gradient-to-r from-emerald-600 to-teal-600"
    >
      <div class="flex items-center gap-2 text-white">
        <!-- ticket icon -->
        <svg class="h-5 w-5 opacity-90" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M4 6a2 2 0 0 1 2-2h8l6 6v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6zm10 0v4a2 2 0 0 0 2 2h4"
          />
        </svg>
        <h3 class="text-base font-semibold tracking-wide">
          Cr√©dits & Transports
        </h3>
      </div>

      <div class="relative w-44">
        <svg
          class="pointer-events-none absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-white/80"
          viewBox="0 0 18 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 14a6 6 0 100-12 6 6 0 000 12zm5 1l3 3"
          />
        </svg>
        <input
          id="search-code"
          [(ngModel)]="searchText"
          placeholder="Filtrer par date‚Ä¶"
          class="w-full rounded-lg bg-white/15 py-1.5 pl-8 pr-3 text-sm text-white placeholder-white/70 ring-1 ring-white/40 focus:ring-2 focus:ring-white/70 outline-none"
        />
      </div>
    </div>

    <!-- Body -->
    <div class="p-4">
      <!-- upload (admin only) -->
      <div *ngIf="auth.isAdmin" class="mb-5 flex items-center gap-3">
        <label
          class="inline-flex cursor-pointer items-center gap-2 rounded-lg bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-700"
        >
          <!-- camera -->
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M9 3l2 2h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2zM12 9a4 4 0 1 0 0 8 4 4 0 0 0 0-8z"
            />
          </svg>
          Joindre un re√ßu
          <input
            type="file"
            hidden
            accept="image/*,application/pdf"
            (change)="uploadReceipt($any($event.target).files)"
          />
        </label>

        <input
          type="number"
          min="0"
          step="0.01"
          placeholder="Montant"
          class="w-28 rounded-lg border border-slate-200 bg-slate-50 p-2.5 text-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100"
          [(ngModel)]="newReceiptAmount"
        />

        <!-- small admin badge -->
        <span
          class="ml-auto hidden items-center gap-1 rounded-full px-2 py-0.5 text-xs ring-1 ring-emerald-300 bg-emerald-50 text-emerald-700 dark:ring-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200 sm:inline-flex"
        >
          Admin
        </span>
      </div>

      <!-- list (or empty state) -->
      <ng-container *ngIf="filteredReceipts().length > 0; else emptyState">
        <ul role="list" class="divide-y divide-slate-200 dark:divide-slate-700">
          <li
            *ngFor="let r of filteredReceipts(); let i = index"
            class="group rounded-lg px-2 py-3 sm:py-4 hover:bg-slate-50 dark:hover:bg-slate-800/60"
          >
            <div class="flex items-center gap-4">
              <!-- initials -->
              <div
                class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-slate-100 to-slate-200 text-sm font-semibold text-slate-700 ring-1 ring-black/5 dark:from-slate-700 dark:to-slate-600 dark:text-slate-100 dark:ring-white/10"
              >
                {{ auth.currentUser.firstName?.substring(0, 2) }}
              </div>

              <!-- date + sublabel -->
              <div class="min-w-0 flex-1">
                <p
                  class="truncate text-sm font-medium text-slate-900 dark:text-slate-50"
                >
                  {{ r.frenchDate }}
                </p>
                <p class="text-xs text-slate-500 dark:text-slate-400">Re√ßu</p>
              </div>

              <!-- amount / edit -->
              <ng-container *ngIf="!auth.isAdmin; else amountEdit">
                <span
                  class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-200 dark:ring-emerald-800"
                >
                  {{ r.amount | number : "1.0-2" }} $
                </span>
              </ng-container>
              <ng-template #amountEdit>
                <input
                  type="number"
                  min="0"
                  step="0.01"
                  class="w-24 rounded border border-slate-200 bg-slate-50 p-1.5 text-xs focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100"
                  [(ngModel)]="r.amount"
                  (blur)="updateAmount(r)"
                />
              </ng-template>

              <!-- receipt link -->
              <a
                [href]="r.url"
                target="_blank"
                title="Voir le re√ßu"
                class="shrink-0"
              >
                <img
                  src="../../../assets/img/validating-ticket.png"
                  class="h-12 w-12 rounded-md border border-slate-200 object-cover bg-white dark:border-slate-700 dark:invert dark:brightness-110"
                  alt="Re√ßu"
                />
              </a>

              <!-- admin ‚Äòchanger‚Äô -->
              <button
                *ngIf="auth.isAdmin"
                class="ml-1 rounded-lg bg-blue-600 px-2.5 py-1.5 text-xs font-medium text-white hover:bg-blue-700"
                (click)="prepareUpdate(r)"
              >
                Changer
              </button>
            </div>
          </li>
        </ul>

        <!-- See more button for admin -->
        <div *ngIf="auth.isAdmin && receipts.length > 2 && !showAllReceipts" class="mt-4 flex justify-center">
          <button
            (click)="showAllReceipts = true"
            class="px-4 py-2 text-sm font-medium text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
          >
            Voir plus
          </button>
        </div>

        <!-- See less button for admin -->
        <div *ngIf="auth.isAdmin && receipts.length > 2 && showAllReceipts" class="mt-4 flex justify-center">
          <button
            (click)="showAllReceipts = false"
            class="px-4 py-2 text-sm font-medium text-white bg-slate-600 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2"
          >
            Voir moins
          </button>
        </div>
      </ng-container>

      <!-- empty state -->
      <ng-template #emptyState>
        <div
          class="flex flex-col items-center justify-center rounded-xl border border-dashed border-slate-200 p-8 text-center dark:border-slate-700"
        >
          <svg
            class="h-8 w-8 text-slate-400 dark:text-slate-500"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M7 3h10l4 4v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V7l4-4zm8 0v4h4"
            />
          </svg>
          <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
            Aucun re√ßu pour l‚Äôinstant.
          </p>
          <p class="text-xs text-slate-500 dark:text-slate-400">
            Ajoutez un re√ßu ou affinez votre recherche.
          </p>
        </div>
      </ng-template>

      <!-- hidden file input for ‚ÄúChanger‚Äù -->
      <input
        #fileInput
        type="file"
        hidden
        accept="image/*,application/pdf"
        (change)="replaceReceipt($any($event.target).files)"
      />
    </div>
  </div>
</section>
<!-- ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ -->

<!-- ‚ïî‚ïê‚ïê‚ïê D√©verrouiller les paiements ‚ïê‚ïê‚ïê‚ïó -->
<div
  *ngIf="showCodeModal && !isPayUnlocked"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/60"
>
  <div class="w-80 rounded-lg bg-white dark:bg-gray-800 p-6 shadow-lg">
    <p class="mb-4 text-gray-900 dark:text-gray-100">
      Entrez votre <strong>code personnel</strong> pour accedder a cette page :
    </p>

    <input
      class="mb-4 w-full rounded border p-2 dark:bg-gray-700 dark:text-white"
      [formControl]="payCodeInput"
      (keyup.enter)="unlockPayment()"
      placeholder="Code secret"
      autofocus
    />

    <button
      class="mb-2 w-full rounded bg-green-700 py-2 font-medium text-white hover:bg-green-800"
      (click)="unlockPayment()"
    >
      Valider
    </button>

    <button
      (click)="closeCodeModal()"
      class="w-full rounded border py-2 font-medium text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700"
    >
      Annuler
    </button>

    <p
      *ngIf="payErrMsg"
      class="mt-3 text-center text-red-600 dark:text-red-400"
    >
      {{ payErrMsg }}
    </p>
  </div>
</div>
<!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
