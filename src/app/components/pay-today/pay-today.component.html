<!-- ─── BARRE DE NAVIGATION ───────────────────────────────────────── -->
<app-navbar
  [email]="auth.currentUser.email"
  [firstName]="auth.currentUser.firstName"
  [path]="'home'">
</app-navbar>

<!-- ─── EN-TÊTE ───────────────────────────────────────────────────── -->
<header class="container mx-auto mt-10 flex flex-col items-center gap-4">
  <h2 class="text-center text-2xl md:text-3xl font-semibold tracking-wide
             bg-gradient-to-r from-green-600 via-emerald-400 to-lime-300
             bg-clip-text text-transparent drop-shadow-sm">
    Retracer les activités selon vos critères
  </h2>

  <button routerLink="/client-info"
          class="inline-flex items-center gap-2 px-4 py-2.5 rounded-full
                 bg-gradient-to-br from-emerald-600 to-green-700
                 hover:from-emerald-500 hover:to-green-600
                 text-white text-sm md:text-base shadow-lg
                 transition-all duration-300 focus:outline-none focus:ring-4
                 focus:ring-emerald-300">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 md:w-5 md:h-5"
         fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    Info client
  </button>
</header>

<!-- ─── CRITÈRES ──────────────────────────────────────────────────── -->
<section class="container mx-auto mt-8">
  <div class="flex flex-wrap justify-center gap-2 md:gap-3
              bg-white/40 dark:bg-slate-600 backdrop-blur-sm
              p-4 rounded-xl shadow-lg">

    <!-- 1) Jour de Paiement -->
    <button
      (click)="setSerachCriteria('paymentDay')"
      [ngClass]="getButtonClasses('paymentDay')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      Jour de Paiement
    </button>

    <!-- 2) X Semaines Sans Payer -->
    <button
      (click)="setSerachCriteria('xWeeksWithoutPayment')"
      [ngClass]="getButtonClasses('xWeeksWithoutPayment')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      X Semaines Sans Payer
    </button>

    <!-- 3) Score Crédit -->
    <button
      (click)="setSerachCriteria('creditScore')"
      [ngClass]="getButtonClasses('creditScore')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600
             transition-colors duration-200 shadow-sm">
      Score Crédit
    </button>

    <!-- 4) Montant Emprunté -->
    <button
      (click)="setSerachCriteria('loanAmount')"
      [ngClass]="getButtonClasses('loanAmount')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600
             transition-colors duration-200 shadow-sm">
      Montant Emprunté
    </button>

    <!-- 5) Montant Emprunté Ou Plus -->
    <button
      (click)="setSerachCriteria('loanAmountMore')"
      [ngClass]="getButtonClasses('loanAmountMore')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      Montant Emprunté Ou Plus
    </button>

    <!-- 6) Montant Restant -->
    <button
      (click)="setSerachCriteria('debtLeft')"
      [ngClass]="getButtonClasses('debtLeft')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      Montant Restant
    </button>

    <!-- 7) Montant Restant Ou Plus -->
    <button
      (click)="setSerachCriteria('debtLeftMore')"
      [ngClass]="getButtonClasses('debtLeftMore')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      Montant Restant Ou Plus
    </button>

    <!-- 8) Montant Perçu -->
    <button
      (click)="setSerachCriteria('amountPaid')"
      [ngClass]="getButtonClasses('amountPaid')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      Montant Perçu
    </button>

    <!-- 9) Agent -->
    <button
      (click)="setSerachCriteria('agent')"
      [ngClass]="getButtonClasses('agent')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      Agent
    </button>

    <!-- 10) Cycle Dette Début Mois -->
    <button
      (click)="setSerachCriteria('debtCycleStartDate')"
      [ngClass]="getButtonClasses('debtCycleStartDate')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      Cycle Dette Début Mois
    </button>

    <!-- 11) # Cycle de Dette -->
    <button
      (click)="setSerachCriteria('debtCycle')"
      [ngClass]="getButtonClasses('debtCycle')"
      class="px-3 py-1.5 rounded-full text-sm font-medium
             border border-gray-300 dark:border-gray-600
             bg-gray-50 dark:bg-slate-700
             hover:bg-emerald-600 
             transition-colors duration-200 shadow-sm">
      # Cycle de Dette
    </button>

    <!-- Case "Au moins ce score" -->
    <div *ngIf="selectedField === 'creditScore'"
         class="flex items-center gap-2 ml-1">
      <input id="atLeastCreditScore" type="checkbox"
             [(ngModel)]="atLeastCreditScore" (change)="reapplyFilter()"
             class="w-4 h-4 text-emerald-600 bg-gray-100 border-gray-300 rounded
                    focus:ring-emerald-500">
      <label for="atLeastCreditScore"
             class="text-sm font-medium text-gray-600 dark:text-gray-300">
        Au moins ce score
      </label>
    </div>
  </div>
</section>

<!-- ─── RÉSUMÉ NOMBRE / TOTAL ───────────────────────────────────── -->
<div class="container mx-auto text-center mt-6">
  <h2 class="inline-flex items-center gap-2 px-4 py-2 rounded-lg
             bg-emerald-50 dark:bg-slate-700 text-emerald-700
             dark:text-lime-300 font-semibold shadow">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5"
         fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M17 20h5V4H2v16h5m10 0a2 2 0 01-2-2v-3M9 20H7m8-6h.01M5 8h.01M12 8h.01M19 8h.01M5 12h.01M12 12h.01M19 12h.01M5 16h.01M12 16h.01" />
    </svg>
    {{ numberOfPeople }} clients – Total : {{ totalGivenDate | number:'1.0-0' }} FC
  </h2>
</div>

<!-- ─── LISTE & RECHERCHE ───────────────────────────────────────── -->
<section class="container mx-auto mt-8 max-w-xl">
  <div class="bg-white/90 dark:bg-slate-800 backdrop-blur-lg
              rounded-2xl shadow-xl ring-1 ring-black/5 p-6 space-y-6">

    <!-- Barre de recherche -->
    <div class="flex items-center justify-between ">
      <h3 class="text-lg md:text-xl font-semibold text-gray-800 dark:text-white">
        Programmé
      </h3>

      <form class="relative flex-1 max-w-xs">
        <input id="simple-search" type="text"
               [formControl]="searchControl"
               placeholder="Rechercher…"
               class="w-full dark:text-white pl-10 pr-3 py-2 rounded-full
                      bg-gray-50 dark:bg-slate-700 border border-gray-300
                      dark:border-gray-600 text-sm
                      focus:ring-2 focus:ring-emerald-500
                      focus:border-emerald-500 outline-none">

        <span class="absolute left-3 top-2.5 text-gray-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
               fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="m21 21-4.35-4.35M5.5 11a5.5 5.5 0 1111 0 5.5 5.5 0 01-11 0z" />
          </svg>
        </span>
      </form>
    </div>

    <!-- Liste des clients -->
    <ul role="list" class="divide-y divide-gray-200  dark:text-gray-300">
      <li *ngFor="let c of filteredItems"
          class="group flex items-center py-4 hover:bg-gray-50 dark:hover:bg-slate-700
                 rounded-lg px-2 transition-colors cursor-pointer"
          [routerLink]="['/client-portal', c.trackingId]">

        <div class="relative inline-flex items-center justify-center
                    w-11 h-11 bg-emerald-100 dark:bg-emerald-900/30
                    text-emerald-700 dark:text-emerald-300
                    font-semibold rounded-full shadow">
          {{ c.firstName?.substring(0,2) }}
        </div>

        <div class="ml-4 flex-1 overflow-hidden">
          <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
            {{ c.firstName }} {{ c.lastName }} {{ c.middleName }}
          </p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">
            {{ c.frenchPaymentDay }} • Agent : {{ c.employee?.firstName }}
          </p>
        </div>

        <div class="text-right ml-4">
          <p class="text-sm font-semibold text-gray-800 dark:text-lime-300">
            FC {{ c.debtLeft | number:'1.0-0' }}
          </p>
          <p class="text-xs text-gray-500 dark:text-gray-400">
            {{ c.amountPaid | number:'1.0-0' }}
          </p>
        </div>
      </li>
    </ul>
  </div>
</section>
