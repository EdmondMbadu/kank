<app-navbar
  [email]="auth.currentUser?.email"
  [firstName]="auth.currentUser?.firstName"
  [path]="'home'"
></app-navbar>

<section class="certificate-page">
  <div class="certificate-hero container">
    <div class="hero-copy">
      <span class="hero-eyebrow">Fiert√© Fondation Gervais</span>
      <h1 class="hero-title">Tableau d'honneur</h1>
      <span class="hero-period">
        {{ preposition }} {{ time.monthFrenchNames[givenMonth] }}
        {{ givenYear }}
      </span>
      <p class="hero-subtitle">
        D√©couvrez les √©quipes et talents qui se d√©marquent ce mois-ci et
        partagez leurs succ√®s.
      </p>
      <button
        *ngIf="auth.isAdmin"
        type="button"
        class="primary-action"
        (click)="toggleDisplayAddTeam()"
      >
        + Ajouter un certificat
      </button>
    </div>

    <div class="hero-controls">
      <div class="selector">
        <label class="selector-label" for="monthSelect">Mois</label>
        <div class="selector-control">
          <select
            id="monthSelect"
            class="selector-input"
            [(ngModel)]="givenMonth"
            (ngModelChange)="updateSelection()"
          >
            <option *ngFor="let month of monthsList" [ngValue]="month">
              {{ time.monthFrenchNames[month] }}
            </option>
          </select>
        </div>
      </div>

      <div class="selector">
        <label class="selector-label" for="yearSelect">Ann√©e</label>
        <div class="selector-control">
          <select
            id="yearSelect"
            class="selector-input"
            [(ngModel)]="givenYear"
            (ngModelChange)="updateSelection()"
          >
            <option *ngFor="let year of yearsList" [ngValue]="year">
              {{ year }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <ng-container *ngIf="selectedBest; else emptyState">
    <div class="certificate-grid container">
      <article
        *ngIf="selectedBest?.bestTeam"
        class="certificate-card accent-team"
      >
        <span class="card-accent" aria-hidden="true"></span>
        <span class="card-badge">Meilleure √©quipe</span>
        <a
          *ngIf="selectedBest?.bestTeamCertificateDownloadUrl"
          class="card-media"
          [href]="selectedBest?.bestTeamCertificateDownloadUrl"
          target="_blank"
          rel="noopener"
        >
          <img
            [src]="selectedBest?.bestTeamCertificateDownloadUrl"
            alt="Certificat de la meilleure √©quipe"
          />
        </a>
        <div
          *ngIf="!selectedBest?.bestTeamCertificateDownloadUrl"
          class="card-media placeholder"
        >
          <span>Aucun certificat partag√©</span>
        </div>
        <div class="card-body">
          <h3>
            {{ selectedBest?.bestTeam }}
          </h3>
          <p>F√©licitations pour ce travail d'√©quipe exemplaire üéâ</p>
          <a
            *ngIf="selectedBest?.bestTeamCertificateDownloadUrl"
            class="card-link"
            [href]="selectedBest?.bestTeamCertificateDownloadUrl"
            target="_blank"
            rel="noopener"
          >
            Voir le certificat
          </a>
        </div>
      </article>

      <!-- Best employee highlight card -->
      <article
        *ngIf="selectedBest?.bestEmployee"
        class="certificate-card accent-employee"
      >
        <span class="card-accent" aria-hidden="true"></span>
        <span class="card-badge">Meilleur employ√©</span>
        <a
          *ngIf="selectedBest?.bestEmployeeCertificateDownloadUrl"
          class="card-media"
          [href]="selectedBest?.bestEmployeeCertificateDownloadUrl"
          target="_blank"
          rel="noopener"
        >
          <img
            [src]="selectedBest?.bestEmployeeCertificateDownloadUrl"
            alt="Certificat du meilleur employ√©"
          />
        </a>
        <div
          *ngIf="!selectedBest?.bestEmployeeCertificateDownloadUrl"
          class="card-media placeholder"
        >
          <span>Aucun certificat partag√©</span>
        </div>
        <div class="card-body">
          <h3>
            {{ selectedBest?.bestEmployee }}
          </h3>
          <p>
            Performance :
            <strong>{{ selectedBest?.bestEmployeePerformance }}</strong>
          </p>
          <a
            *ngIf="selectedBest?.bestEmployeeCertificateDownloadUrl"
            class="card-link"
            [href]="selectedBest?.bestEmployeeCertificateDownloadUrl"
            target="_blank"
            rel="noopener"
          >
            Voir le certificat
          </a>
        </div>
      </article>

      <article
        *ngIf="selectedBest?.bestManager"
        class="certificate-card accent-manager"
      >
        <span class="card-accent" aria-hidden="true"></span>
        <span class="card-badge">Meilleur manager</span>
        <a
          *ngIf="selectedBest?.bestManagerCertificateDownloadUrl"
          class="card-media"
          [href]="selectedBest?.bestManagerCertificateDownloadUrl"
          target="_blank"
          rel="noopener"
        >
          <img
            [src]="selectedBest?.bestManagerCertificateDownloadUrl"
            alt="Certificat du meilleur manager"
          />
        </a>
        <div
          *ngIf="!selectedBest?.bestManagerCertificateDownloadUrl"
          class="card-media placeholder"
        >
          <span>Aucun certificat partag√©</span>
        </div>
        <div class="card-body">
          <h3>
            {{ selectedBest?.bestManager }}
          </h3>
          <p>Une inspiration pour toute l'√©quipe ‚ú®</p>
          <a
            *ngIf="selectedBest?.bestManagerCertificateDownloadUrl"
            class="card-link"
            [href]="selectedBest?.bestManagerCertificateDownloadUrl"
            target="_blank"
            rel="noopener"
          >
            Voir le certificat
          </a>
        </div>
      </article>
    </div>
  </ng-container>

  <ng-template #emptyState>
    <div class="empty-state container">
      <div class="empty-card">
        <h3>Aucun laur√©at pour cette p√©riode</h3>
        <p>
          S√©lectionnez un autre mois ou, si vous √™tes administrateur, ajoutez
          les gagnants pour garder l'√©quipe motiv√©e.
        </p>
        <button
          *ngIf="auth.isAdmin"
          type="button"
          class="secondary-action"
          (click)="toggleDisplayAddTeam()"
        >
          Ajouter un certificat
        </button>
      </div>
    </div>
  </ng-template>
</section>

<div
  *ngIf="displayAddTeam"
  class="modal-backdrop"
  role="dialog"
  aria-modal="true"
>
  <div class="modal-panel">
    <header class="modal-header">
      <div>
        <h2 id="addCertificateTitle">Ajouter un certificat</h2>
        <p>
          Renseignez les gagnants du mois s√©lectionn√© et joignez leurs
          certificats officiels.
        </p>
      </div>
      <button
        type="button"
        class="icon-button"
        aria-label="Fermer"
        (click)="toggleDisplayAddTeam()"
      >
        √ó
      </button>
    </header>

    <div class="modal-body">
      <div class="form-grid">
        <label class="form-field">
          <span class="field-label">Mois</span>
          <input
            class="text-input"
            type="text"
            [value]="certificate.month"
            readonly
          />
        </label>

        <label class="form-field">
          <span class="field-label">Ann√©e</span>
          <input
            class="text-input"
            type="text"
            [value]="certificate.year"
            readonly
          />
        </label>

        <label class="form-field">
          <span class="field-label">Meilleure √©quipe</span>
          <input
            class="text-input"
            type="text"
            name="bestTeam"
            [(ngModel)]="certificate.bestTeam"
            placeholder="Ex : Pumbu"
          />
        </label>

        <label class="form-field">
          <span class="field-label">Meilleur employ√©</span>
          <input
            class="text-input"
            type="text"
            name="bestEmployee"
            [(ngModel)]="certificate.bestEmployee"
            placeholder="Ex : Helene Tsimba"
          />
        </label>

        <label class="form-field">
          <span class="field-label"> Performance du meilleur employ√© (%) </span>
          <input
            class="text-input"
            type="text"
            name="bestEmployeePerformance"
            [(ngModel)]="certificate.bestEmployeePerformance"
            placeholder="Ex : 95"
          />
        </label>

        <label class="form-field">
          <span class="field-label">Meilleur manager</span>
          <input
            class="text-input"
            type="text"
            name="bestManager"
            [(ngModel)]="certificate.bestManager"
            placeholder="Ex : Naomie Botuli"
          />
        </label>
      </div>

      <div class="upload-grid">
        <div class="upload-field">
          <span class="field-label">Certificat - meilleure √©quipe</span>
          <label class="upload-card" for="getTeam">
            <ng-container
              *ngIf="
                certificate.bestTeamCertificateDownloadUrl;
                else teamPlaceholder
              "
            >
              <img
                [src]="certificate.bestTeamCertificateDownloadUrl"
                alt="Aper√ßu du certificat √©quipe"
              />
            </ng-container>
          </label>
          <input
            id="getTeam"
            class="hidden-file-input"
            type="file"
            (change)="
              startUploadCertificate($any($event.target).files, 'getTeam')
            "
          />
          <ng-template #teamPlaceholder>
            <div class="upload-placeholder">
              <span>D√©poser ou cliquer pour t√©l√©verser</span>
            </div>
          </ng-template>
        </div>

        <div class="upload-field">
          <span class="field-label">Certificat - meilleur employ√©</span>
          <label class="upload-card" for="getEmploye">
            <ng-container
              *ngIf="
                certificate.bestEmployeeCertificateDownloadUrl;
                else employeePlaceholder
              "
            >
              <img
                [src]="certificate.bestEmployeeCertificateDownloadUrl"
                alt="Aper√ßu du certificat employ√©"
              />
            </ng-container>
          </label>
          <input
            id="getEmploye"
            class="hidden-file-input"
            type="file"
            (change)="
              startUploadCertificate($any($event.target).files, 'getEmploye')
            "
          />
          <ng-template #employeePlaceholder>
            <div class="upload-placeholder">
              <span>D√©poser ou cliquer pour t√©l√©verser</span>
            </div>
          </ng-template>
        </div>

        <div class="upload-field">
          <span class="field-label">Certificat - meilleur manager</span>
          <label class="upload-card" for="getManager">
            <ng-container
              *ngIf="
                certificate.bestManagerCertificateDownloadUrl;
                else managerPlaceholder
              "
            >
              <img
                [src]="certificate.bestManagerCertificateDownloadUrl"
                alt="Aper√ßu du certificat manager"
              />
            </ng-container>
          </label>
          <input
            id="getManager"
            class="hidden-file-input"
            type="file"
            (change)="
              startUploadCertificate($any($event.target).files, 'getManager')
            "
          />
          <ng-template #managerPlaceholder>
            <div class="upload-placeholder">
              <span>D√©poser ou cliquer pour t√©l√©verser</span>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <footer class="modal-footer">
      <button
        type="button"
        class="secondary-action"
        (click)="toggleDisplayAddTeam()"
      >
        Annuler
      </button>
      <button type="button" class="primary-action" (click)="updateData()">
        Ajouter
      </button>
    </footer>
  </div>
</div>
