<app-navbar [email]="this.auth.currentUser.email"[firstName]="this.auth.currentUser.firstName" [path]="'home'"></app-navbar>
<div class="flex container mx-auto m-12 justify-center">
    <h1 class="text-xl md:text-3xl mr-4">Paiement Par {{client.firstName}} {{client.lastName}}</h1>
</div>

<div class="flex container justify-center mx-auto">

<div class=" border-2 border-green-800 rounded-lg p-12">
<div class="mb-6">
    <label for="paymentMethod" class="block mb-2 text-sm font-medium text-gray-900">Mode de Paiement</label>
    <select
      id="paymentMethod"
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
      [(ngModel)]="paymentMethod"
      (change)="onPaymentMethodChange()"
    >
      <option value="manual">Paiement Manuel</option>
      <option *ngIf="auth.isAdmninistrator" value="mobile">Payer par Mobile Money</option>
    </select>
</div>

<div class="mb-6">
    <label for="savings" class="block mb-2 text-sm font-medium text-gray-900">Epargnes</label>
    <select id="countries" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5  " [(ngModel)]="savingsAmount" (change)="displaySavingsOtherAmount()"selected>
        <option [ngValue]="0">FC 0</option>
        <option [ngValue]="5000">FC 5000</option>
    <option [ngValue]="10000">FC 10,000</option>
    <option [ngValue]="20000">FC 20,000</option>
    <option [ngValue]="30000">FC 30,000</option>
    <option [ngValue]="" >Autre Montant</option>
    </select>
</div>
<div *ngIf="savingsOtherAmount" class="mb-6">
    <label for="savingsOther" class="block mb-2 text-sm font-medium text-gray-900 "> Epargnes Autre Amount</label>
    <input [(ngModel)]="savingsAmount" type="text" id="savings" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="FC20,000" required>
</div> 



<div class="mb-6">
    <label for="payment" class="block mb-2 text-sm font-medium text-red-700">Montant De Paiement</label>
    <select id="payment" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5  " [(ngModel)]="paymentAmount"(change)="displayPaymentOtherAmount()"selected>
    <option [ngValue]=minPayment>FC {{minPayment}}</option>

    <option [ngValue]="">Autre Montant </option>
    </select>
</div>
<div *ngIf="paymentOtherAmount" class="mb-6">
    <label for="savings" class="block mb-2 text-sm font-medium text-gray-900 "> Payment Autre Montant</label>
    <input type="text" [(ngModel)]="paymentAmount"id="savings" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="FC20,000" required>
</div> 

<div *ngIf="paymentMethod === 'mobile'" class="mb-6">
    <label for="mobileMoneyPhone" class="block mb-2 text-sm font-medium text-gray-900">Téléphone Mobile Money (10 chiffres)</label>
    <input
      id="mobileMoneyPhone"
      type="tel"
      inputmode="numeric"
      maxlength="10"
      [(ngModel)]="mobileMoneyPhone"
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
      placeholder="0893258653"
    />
    <p class="mt-1 text-xs text-gray-500">
      Numéro du client par défaut, modifiable si nécessaire.
    </p>
</div>

<div *ngIf="paymentMethod === 'mobile' && mobileMoneyOrderNumber" class="mb-3 text-xs text-gray-600">
  Référence FlexPay: {{ mobileMoneyReference }} | Order: {{ mobileMoneyOrderNumber }}
</div>

<div *ngIf="mobileMoneyStatus" class="mb-3 rounded-lg bg-blue-50 border border-blue-200 p-3 text-sm text-blue-700">
  {{ mobileMoneyStatus }}
</div>

<div *ngIf="mobileMoneyError" class="mb-3 rounded-lg bg-red-50 border border-red-200 p-3 text-sm text-red-700">
  {{ mobileMoneyError }}
</div>


   

<button class="mr-10 text-white bg-green-700 hover:bg-green-800 font-medium rounded-full text-sm w-auto sm:w-auto px-5 py-2.5 text-center " [routerLink]="['/client-portal',id ]">Annuler</button>
   <button
  (click)="submitPayment()"
  [disabled]="isSubmitting"
  class="relative text-white bg-green-700 hover:bg-green-800 font-medium rounded-full text-sm w-auto sm:w-auto px-5 py-2.5 text-center disabled:opacity-60 disabled:cursor-not-allowed"
>
  <span *ngIf="!isSubmitting; else loadingBtn">Soumettre</span>
  <ng-template #loadingBtn>
    <span class="inline-flex items-center gap-2">
      Traitement…
      <svg class="h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.25"></circle>
        <path d="M22 12a10 10 0 0 1-10 10" stroke="currentColor" stroke-width="4" stroke-linecap="round" opacity="0.9"></path>
      </svg>
    </span>
  </ng-template>
</button>

<!-- Blocking overlay while submitting -->
<div *ngIf="isSubmitting"
     class="fixed inset-0 z-50 bg-black/40 backdrop-blur-sm flex items-center justify-center">
  <div class="rounded-2xl bg-white dark:bg-slate-800 p-6 shadow-xl text-center max-w-xs">
    <div class="mx-auto mb-3 h-10 w-10 rounded-full border-4 border-emerald-600 border-t-transparent animate-spin"></div>
    <p class="text-sm text-gray-700 dark:text-gray-300 font-medium">Enregistrement du paiement…</p>
    <p class="mt-1 text-[11px] text-gray-500 dark:text-gray-400">Veuillez patienter, ne fermez pas la page.</p>
  </div>
</div>

   
</div>


</div>
